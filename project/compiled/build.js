"use strict";var _setup,_config$setup_name,_setup$_config$setup_,_State$variables,_config$State_name,_State$variables$_con,_navtiles,_State$variables$conf,_State$variables$conf2,_State$variables$conf5,_State$variables$conf6,_State$variables$conf7,_State$variables$conf8;function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){_defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){c=!0,n=e},f:function(){try{o||null==a.return||a.return()}finally{if(c)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classPrivateMethodInitSpec(e,t){_checkPrivateRedeclaration(e,t),t.add(e)}function _checkPrivateRedeclaration(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateMethodGet(e,t,a){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return a}var debug={on:{proxy:!1,argObj:!1,macro:!1},log:function(e,t){(e=Array.isArray(e)?e:[e]).filter((function(e){return debug.on[e]})).length&&console.log(t)}},_add_arr=new WeakSet,_add_obj=new WeakSet,_push=new WeakSet,TypeSet=function(){function e(){_classCallCheck(this,e),_classPrivateMethodInitSpec(this,_push),_classPrivateMethodInitSpec(this,_add_obj),_classPrivateMethodInitSpec(this,_add_arr),this.any=[],this.exact=[],this.other=[],this.label=null,this["this is a TypeSet"]=!0;try{for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];for(var i=0,n=a;i<n.length;i++){var o=n[i];this.add(o)}}catch(e){console.error("failed to create TypeSet object")}}return _createClass(e,[{key:"print",get:function(){if(this.label)return this.label;var t,a=[],r=_createForOfIteratorHelper(this.any);try{for(r.s();!(t=r.n()).done;){var i=t.value;"undefined"===i||"null"===i?a.push("".concat(i)):a.push("any '".concat(i,"'"))}}catch(e){r.e(e)}finally{r.f()}var n,o=_createForOfIteratorHelper(this.exact);try{for(o.s();!(n=o.n()).done;){var c=n.value;a.push("exactly the ".concat(e.id(c)," '").concat(c,"'"))}}catch(e){o.e(e)}finally{o.f()}return a.join(" or ")}},{key:"add",value:function(t){try{if("array"===e.id(t))_classPrivateMethodGet(this,_add_arr,_add_arr2).call(this,t);else if("object"===e.id(t))_classPrivateMethodGet(this,_add_obj,_add_obj2).call(this,t);else if("string"==typeof t)_classPrivateMethodGet(this,_push,_push2).call(this,t,"any");else{var a='TypeSet - invalid input "'.concat(t,"\", must be 'string' or 'object' or 'array'");console.error(a)}}catch(a){console.error("failed to add ".concat(t," to TypeSet; check 'TypeSet.valid' for valid types")),console.error(a)}}},{key:"has",value:function(t){var a=!1;if("object"!==e.id(t)||1!==Object.keys(t).length||"any"!==Object.keys(t)[0]&&"exact"!==Object.keys(t)[0]&&"other"!==Object.keys(t)[0])for(var r=0,i=[].concat(_toConsumableArray(this.any),_toConsumableArray(this.exact));r<i.length;r++){if(t===i[r]){a=!0;break}}else for(var n=0,o=["any","exact","other"];n<o.length;n++){var c,l=o[n],s=Object.values(t)[0],d=_createForOfIteratorHelper(this[l]);try{for(d.s();!(c=d.n()).done;){if(s===c.value){a=!0;break}}}catch(e){d.e(e)}finally{d.f()}if(a=!0)break}return a}},{key:"accepts",value:function(t){var a=!1;if(this.other.includes("any")&&(a=!0),!a){var r,i=_createForOfIteratorHelper(this.any);try{for(i.s();!(r=i.n()).done;){var n=r.value;if(e.id(t)===n){a=!0;break}}}catch(e){i.e(e)}finally{i.f()}}if(!a){var o,c=_createForOfIteratorHelper(this.exact);try{for(c.s();!(o=c.n()).done;){if(t===o.value){a=!0;break}}}catch(e){c.e(e)}finally{c.f()}}return a}}],[{key:"validate",value:function(t){if(!e.valid.includes(t)){var a='TypeSet - "'.concat(t,"\" is not a valid type; use 'TypeSet.valid' to get the array of valid types; use exact to add the exact value");throw new Error(a)}}},{key:"valid",get:function(){return["string","number","object","boolean","undefined","array","null"]}},{key:"id",value:function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}},{key:"isTypeSet",value:function(e){return"object"===_typeof(e)&&!!e["this is a TypeSet"]}}]),e}();function _add_arr2(e,t){if(0===e.length){console.error("TypeSet - array input cannot be empty")}var a,r=_createForOfIteratorHelper(e);try{for(r.s();!(a=r.n()).done;){var i=a.value;t?_classPrivateMethodGet(this,_push,_push2).call(this,i,t):this.add(i)}}catch(e){r.e(e)}finally{r.f()}}function _add_obj2(e){for(var t in e)if("any"!==t&&"exact"!==t&&"other"!==t||"array"!==TypeSet.id(e[t]))if("any"===t||"exact"===t||"other"===t)_classPrivateMethodGet(this,_push,_push2).call(this,e[t],t);else if("label"===t){if("string"!==TypeSet.id(e[t])){var a='TypeSet - input for label "'.concat(e[t],"\" ('").concat(TypeSet.id(e[t]),"') should be a string instead");console.error(a)}this.label=e[t]}else{var r="TypeSet - unexpected object key ".concat(t);console.error(r)}else _classPrivateMethodGet(this,_add_arr,_add_arr2).call(this,e[t],t)}function _push2(e,t){try{if(this[t].includes(e))return;if("any"===t)TypeSet.validate(e),this.any.push(e);else if("exact"===t)this.exact.push(e);else if("any"===e)this.other.push(e);else{var a="TypeSet - unexpected input for ".concat(t,'-type "').concat(e,'"');console.error(a)}}catch(a){console.error("failed to push ".concat(t,"-type to TypeSet at arg ").concat(e)),console.error(a)}}function create_argObj(e){if(void 0===e)throw new Error("".concat(this.name," - failed, missing input (create_argObj)"));var t=e.id,a=e.template,r=e.options,i=clone(e.args_in);if(void 0===t)throw new Error("".concat(this.name," - failed, missing required id (create_argObj)"));if(void 0===a)throw new Error("".concat(t," - failed, missing required template (create_argObj)"));if(void 0===i)throw new Error("".concat(t," - failed, missing required args_in (create_argObj)"));var n=Object.keys(a);if(!n.length)throw new Error("".concat(t," - failed, template can't be empty (create_argObj)"));var o={};try{for(var c=0,l=n;c<l.length;c++){var s=l[c];if(o[s]=s,void 0!==a[s].alias)if("array"===TypeSet.id(a[s].alias)){var d,h=_createForOfIteratorHelper(a[s].alias);try{for(h.s();!(d=h.n()).done;){var p=d.value;if(void 0!==o[p])throw new Error("".concat(t," - failed, clobbering alias ").concat(p," (create_argObj)"));o[p]=s}}catch(e){h.e(e)}finally{h.f()}}else{if(void 0!==o[a[s].alias])throw new Error("".concat(t," - failed, clobbering alias ").concat(a[s].alias," (create_argObj)"));o[a[s].alias]=s}}}catch(e){console.error("".concat(t," - failed to create aliases while parsing macro arguments (create_argObj)")),console.error(e)}var u={},v={id:t,args_in:i,template:a,keys:n,output:u,alias:o,options:r,splice:0};try{for(;v.args_in.length>0;){debug.log("argObj","entered loop"),debug.log("argObj",v),v.splice=0;var y=v.args_in[0];try{0===v.splice&&n.includes(o[y])&&argObj_kvp.call(this,v),0===v.splice&&y.isLink&&argObj_markup.call(this,v),0===v.splice&&"object"===TypeSet.id(y)&&argObj_obj.call(this,v);var m=_objectSpread({strict:!1},r).strict;if(0!==v.splice||m||argObj_lazy.call(this,v),!(v.splice>0))return console.error(u),this.error("".concat(t,' - unexpected input "').concat(y,'", is not a key name and did not match any valid types'));v.args_in.splice(0,v.splice)}catch(e){console.error("".concat(t,' - failed to create argObj at "').concat(y,'" for "').concat(t,'" (create_argObj)')),console.error(e)}}return u}catch(e){console.error("".concat(t," - failed to create argObj from macro arguments (create_argObj)")),console.error(e)}}function argObj_markup(e){debug.log("argObj","entered markup"),debug.log("argObj",e);var t=e.id,a=e.args_in,r=e.keys,i=e.output,n=a[0];try{return r.includes("passage")?(i.linktext=n.text,i.passage=n.link,e.splice=1,e):this.error("".concat(t," - macro does not accept [[markup]]"))}catch(e){console.error("".concat(t," - failed to parse macro arguments inside [[markup]] parser (argObj_markup)")),console.error(e)}}function argObj_kvp(e){debug.log("argObj","entered kvp"),debug.log("argObj",e);var t=e.id,a=e.args_in,r=e.template,i=e.output,n=e.alias,o=a[0],c=a[1];try{if("undefined"===TypeSet.id(c))return this.error("".concat(t,' - no input was found for argument "').concat(o,'"'));var l=new TypeSet(r[n[o]].type);return l.accepts(c)?(i[n[o]]=c,e.splice=2,e):this.error("".concat(t,' - "').concat(c,"\" is an invalid type ('").concat(TypeSet.id(c),"') for \"").concat(o,'", expected ').concat(l.print))}catch(e){console.error("".concat(t," - failed to parse macro arguments inside KVP parser (argObj_kvp)")),console.error(e)}}function argObj_obj(e){debug.log("argObj","entered object parser"),debug.log("argObj",e);var t=e.id,a=e.args_in,r=e.template,i=e.keys,n=e.output,o=e.alias,c=a[0];try{for(var l in c)if(i.includes(o[l])){var s=new TypeSet(r[o[l]].type);if(!s.accepts(c[l]))return this.error("".concat(t,' - "').concat(c[l],'" is an invalid type for "').concat(l,"\" ('").concat(TypeSet.id(c[l]),"'), expected ").concat(s.print));n[o[l]]=c[l],e.splice=1}return e}catch(e){console.error("".concat(t," - failed to parse macro arguments inside object parser (argObj_obj)")),console.error(e)}}function argObj_lazy(e){debug.log("argObj","entered lazy matcher"),debug.log("argObj",e);var t=e.id,a=e.args_in,r=e.template,i=e.keys,n=e.output,o=a[0];try{var c=i.filter((function(e){return!Object.keys(n).includes(e)}));if(!c.length)return e;var l,s=_createForOfIteratorHelper(c);try{for(s.s();!(l=s.n()).done;){var d=l.value;if(new TypeSet(r[d].type).accepts(o)){n[d]=o,e.splice=1;break}}}catch(e){s.e(e)}finally{s.f()}return e}catch(e){console.error("".concat(t," - failed to parse macro arguments inside lazy parser (argObj_lazy)")),console.error(e)}}var config={nav:{},wall:{},floor:{},map:{},entity:{},skipcheck:{}};config.nav.diagonal=!1,config.nav.print_names=!1,config.nav.keyboard_codes={N:"Numpad8",E:"Numpad6",S:"Numpad2",W:"Numpad4",NW:"Numpad7",NE:"Numpad9",SE:"Numpad3",SW:"Numpad1"},config.map.fenced=!0,config.entity.solid=!0,config.wall.tileid=".",config.floor.tileid="x",config.skipcheck.clobbering=!1,config.skipcheck.common=!1,config.skipcheck.unused=!1,config.disable_global=!1,config.setup_name="@navmap",config.global_name="Navmap",config.State_name="@navmap",null!==(_setup$_config$setup_=(_setup=setup)[_config$setup_name=config.setup_name])&&void 0!==_setup$_config$setup_||(_setup[_config$setup_name]={}),null!==(_State$variables$_con=(_State$variables=State.variables)[_config$State_name=config.State_name])&&void 0!==_State$variables$_con||(_State$variables[_config$State_name]={});var def=new Proxy(config,get_controller(setup[config.setup_name]));function get_controller(e){return{get:function(t,a){return debug.log("proxy","entered proxy"),void 0===e||void 0===e[a]?(debug.log("entered undefined"),t[a]):(debug.log("proxy","entered defined"),"object"!==_typeof(e[a])||e[a].isproxy||(debug.log("proxy","created proxy"),e[a]=new Proxy(config[a],get_controller(e[a])),e[a].isproxy=!0),e[a])}}}var navmaps={},naventities={},navtiles=(_defineProperty(_navtiles={},String(def.wall.tileid),{tileid:String(def.wall.tileid),tilename:def.wall.tileid,tilehtml:{default:def.wall.tileid},wall:!0}),_defineProperty(_navtiles,String(def.floor.tileid),{tileid:String(def.floor.tileid),tilename:def.floor.tileid,tilehtml:{default:def.floor.tileid},wall:!1}),_navtiles),navdisplays={};function get_navmap(e){return navmaps[e]}function get_navtile(e){return navtiles[e]}function get_naventity(e){return naventities[e]}function get_navdisplay(e){return navdisplays[e]}setup.navmaps=navmaps,setup.navtiles=navtiles,setup.naventities=naventities,setup.navdisplays=navdisplays,null!==(_State$variables$conf2=(_State$variables$conf=State.variables[config.State_name]).navmaps)&&void 0!==_State$variables$conf2||(_State$variables$conf.navmaps={});var Navmap=function(){function e(t,a,r,i,n,o,c){var l,s,d;if(_classCallCheck(this,e),this.error=function(e){throw new Error(e)},!def.skipcheck.clobbering&&navmaps[t])return this.error('Navmap - clobbering, map with id "'.concat(t,'" already exists'));navmaps[String(t)]=this,this.mapid=String(t),null!==(d=(l=State.variables[config.State_name].navmaps)[s=this.mapid])&&void 0!==d||(l[s]={}),this.mapname=null!=a?a:this.mapid,this.diagonal=null!=o?o:def.nav.diagonal,this.fenced=null!=c?c:def.map.fenced,this.actors=[];try{if(void 0===this.arr||void 0===this.cols||void 0===this.rows){if("array"===r){if(this.arr=i,this.cols=n,void 0===n)return this.error('Navmap - missing required input "cols" or "columns" for map "'.concat(this.mapid,'"'));if("array"===r&&this.arr%this.cols)return console.error(i),this.error("Navmap - inputmap is not rectangular")}else{if("2D array"!==r)return this.error('Navmap - invalid inputtype for map "'.concat(this.mapid,"\", only macro payload or 'array' or '2D array' is supported"));this.cols=i[0].length;var h,p=_createForOfIteratorHelper(i);try{for(p.s();!(h=p.n()).done;){var u=h.value;if(!Array.isarray(u))return console.error(u),this.error('Navmap - invalid inputmap, non-array detected for map "'.concat(this.mapid,'"'));if(0===(null==u?void 0:u.length)||(null==u?void 0:u.length)!==this.cols)return console.error(u),this.error('Navmap - invalid inputmap, non-rectangular input detected for map "'.concat(this.mapid,'"'))}}catch(e){p.e(e)}finally{p.f()}this.arr=i.flat()}this.rows=this.arr.length/this.cols}}catch(e){return console.error('Navmap - failed to parse input for inputtype "'.concat(r,'" and inputmap (Navmap)')),console.error(i),this.error(e)}try{var v,y=_createForOfIteratorHelper(new Set(this.arr));try{for(y.s();!(v=y.n()).done;){var m=v.value;void 0===get_navtile(m)&&new Navtile(m)}}catch(e){y.e(e)}finally{y.f()}}catch(e){console.error('Navmap - failed to create default Navtiles for map "'.concat(this.mapid,'"')),console.error(e)}}return _createClass(e,[{key:"arr",get:function(){return State.variables[config.State_name].navmaps[this.mapid].arr},set:function(e){State.variables[config.State_name].navmaps[this.mapid].arr=e}},{key:"cols",get:function(){return State.variables[config.State_name].navmaps[this.mapid].cols},set:function(e){State.variables[config.State_name].navmaps[this.mapid].cols=e}},{key:"rows",get:function(){return State.variables[config.State_name].navmaps[this.mapid].rows},set:function(e){State.variables[config.State_name].navmaps[this.mapid].rows=e}}]),e}();null!==(_State$variables$conf6=(_State$variables$conf5=State.variables[config.State_name]).navtiles)&&void 0!==_State$variables$conf6||(_State$variables$conf5.navtiles={});var Navtile=_createClass((function e(t,a,r,i){var n,o;if(_classCallCheck(this,e),this.error=function(e){throw new Error(e)},!def.skipcheck.clobbering&&navtiles[t])return this.error('Navtile - clobbering, tile with id "'.concat(t,'" already exists'));for(var c in navtiles[String(t)]=this,this.tileid=String(t),this.tilename=null!=a?a:t,this.wall=null!=i&&i,this.tilehtml={},r){if(!def.skipcheck.unused&&void 0===r[c])return this.error("".concat(this.name,' - empty display html for tileid "').concat(t,'" on displayid "').concat(c,'"'));this.tilehtml[c]=r[c]}null!==(o=(n=this.tilehtml).default)&&void 0!==o||(n.default=t)}));null!==(_State$variables$conf8=(_State$variables$conf7=State.variables[config.State_name]).naventities)&&void 0!==_State$variables$conf8||(_State$variables$conf7.naventities={});var Naventity=function(){function e(t,a,r,i){var n,o,c,l,s,d;if(_classCallCheck(this,e),this.error=function(e){throw new Error(e)},!def.skipcheck.clobbering&&naventities[t])return this.error('Naventity - clobbering, entity with id "'.concat(t,'" already exists'));for(var h in naventities[String(t)]=this,this.entityid=String(t),null!==(c=(n=State.variables[config.State_name].naventities)[o=this.entityid])&&void 0!==c||(n[o]={}),this.entityname=null!=a?a:t,this.solid=null!=i?i:def.entity.solid,null!==(l=this.coords)&&void 0!==l||(this.coords={}),this.entityhtml={},r){if(!def.skipcheck.unused&&void 0===r[h])return this.error("".concat(this.name,' - empty display html for entityid "').concat(t,'" on displayid "').concat(h,'"'));this.entityhtml[h]=r[h]}null!==(d=(s=this.entityhtml).default)&&void 0!==d||(s.default=t)}return _createClass(e,[{key:"coords",get:function(){return State.variables[config.State_name].naventities[this.entityid].coords},set:function(e){State.variables[config.State_name].naventities[this.entityid].coords=e}}]),e}();function check_required(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_required)"));if(Object.keys(e).length>1)return this.error("".concat(this.name," - failed extra properties in argObj_in (check_required)"));try{var a,r=Object.keys(e)[0];if(void 0===e[r])return this.error("".concat(this.name,' - missing required argument "').concat(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:r,'"'))}catch(e){console.error("".concat(this.name," - failed to check for required args")),console.error(e)}}function check_oneword(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_oneword)"));if(Object.keys(e).length>1)return this.error("".concat(this.name," - failed extra properties in argObj_in (check_oneword)"));try{var a,r=Object.keys(e)[0];if(e[r].includes(" "))return this.error("".concat(this.name,' - argument "').concat(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:r,'" must be one word, no spaces'))}catch(e){console.error("".concat(this.name," - failed to check args for oneword requirement")),console.error(e)}}function check_extant(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_extant)"));if(Object.keys(e).length>1)return this.error("".concat(this.name," - failed extra properties in argObj_in (check_extant)"));try{var a=Object.keys(e)[0],r=e[a];if("mapid"===a&&void 0===get_navmap(r))return this.error("".concat(this.name,' - no map with id "').concat(r,'" found'));if("tileid"===a&&void 0===get_navtile(r))return this.error("".concat(this.name,' - no tile with id "').concat(r,'" found'));if("entityid"===a&&void 0===get_naventity(r))return this.error("".concat(this.name,' - no entity with id "').concat(r,'" found'));if("displayid"===a&&void 0===get_navdisplay(r)){if(void 0===get_navmap(r))return this.error("".concat(this.name,' - no display with id "').concat(r,'" found'));new_navdisplay.call(this,{mapid:displayid})}}catch(e){console.error("".concat(this.name," - failed to check args for extant requirement")),console.error(e)}}function check_integer(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_integer)"));if(Object.keys(e).length>1)return this.error("".concat(this.name," - failed extra properties in argObj_in (check_integer)"));try{var a,r=Object.keys(e)[0],i=e[r];if(!Number.isInteger(i))return this.error("".concat(this.name,' - argument "').concat(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:r,'" must be an integer'))}catch(e){console.error("".concat(this.name," - failed to check args for integer requirement")),console.error(e)}}function check_positive(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_positive)"));if(Object.keys(e).length>1)return this.error("".concat(this.name," - failed extra properties in argObj_in (check_positive)"));try{var a,r=Object.keys(e)[0];if(e[r]<=0)return this.error("".concat(this.name,' - argument "').concat(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:r,'" must be greater than zero'))}catch(e){console.error("".concat(this.name," - failed to check args for positive requirement")),console.error(e)}}function check_xbound(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_xbound)"));if(2!==Object.keys(e).length)return this.error("".concat(this.name," - failed incorrect # of properties in argObj_in (check_xbound)"));if(void 0===e.mapid)return this.error("".concat(this.name," - failed, missing required mapid in argObj_in (check_xbound)"));if(void 0===e.x)return this.error("".concat(this.name," - failed, missing required x in argObj_in (check_xbound)"));var a=e.x,r=e.mapid,i=get_navmap(r).cols;try{var n,o;if(a<1)return this.error("".concat(this.name,' - argument "').concat(null!==(n=null==t?void 0:t.label)&&void 0!==n?n:"x",'" should have a value of one or greater'));if(a>i)return this.error("".concat(this.name,' - argument "').concat(null!==(o=null==t?void 0:t.label)&&void 0!==o?o:"x",'" should have a value less than or equal to the total number of columns on map "').concat(r,'"'))}catch(e){console.error("".concat(this.name," - failed to check args for positive requirement")),console.error(e)}}function check_ybound(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_xbound)"));if(2!==Object.keys(e).length)return this.error("".concat(this.name," - failed incorrect # of properties in argObj_in (check_xbound)"));if(void 0===e.mapid)return this.error("".concat(this.name," - failed, missing required mapid in argObj_in (check_xbound)"));if(void 0===e.y)return this.error("".concat(this.name," - failed, missing required y in argObj_in (check_xbound)"));var a=e.y,r=e.mapid,i=get_navmap(r).rows;try{var n,o;if(a<1)return this.error("".concat(this.name,' - argument "').concat(null!==(n=null==t?void 0:t.label)&&void 0!==n?n:"y",'" should have a value of one or greater'));if(a>i)return this.error("".concat(this.name,' - argument "').concat(null!==(o=null==t?void 0:t.label)&&void 0!==o?o:"y",'" should have a value less than or equal to the total number of rows on map "').concat(r,'"'))}catch(e){console.error("".concat(this.name," - failed to check args for positive requirement")),console.error(e)}}function print_navtile(e){var t=e.displayid,a=e.tile,r=e.row,i=e.col,n=a.tileid,o=a.tilename,c=a.wall,l=a.tilehtml;try{var s=$(document.createElement("div")),d=void 0===l?n:void 0!==l[t]?l[t]:void 0!==l.default?l.default:n;return s.addClass("Navtile").attr("title",o).attr("data-tileid",n).data("tileid",n).attr("data-wall",c).data("wall",c).css({"grid-column":"".concat(i," / span 1"),"grid-row":"".concat(r," / span 1")}).wiki(d),s}catch(e){console.error("".concat(this.name,' - failed to print navtile element on navdisplay "').concat(t,'"')),console.error(e)}}function print_naventity(e){var t=e.displayid,a=e.entity,r=e.col,i=e.row,n=a.entityid,o=a.entityname,c=a.entityhtml;try{var l=$(document.createElement("div")),s=void 0===c?n:void 0!==c[t]?c[t]:void 0!==c.default?c.default:n;return l.addClass("Naventity").attr("title",o).attr("data-entityid",n).data("entityid",n).css({"grid-column":"".concat(r," / span 1"),"grid-row":"".concat(i," / span 1")}).wiki(s),l}catch(e){console.error("".concat(this.name,' - failed to create entity element for "').concat(n,'" on "').concat(mapid,'"')),console.error(e)}}function print_navdir(e){var t=e.displayid,a=e.mapid,r=e.dir,i=e.entity,n=e.print_names,o=get_navmap(a),c=o.arr,l=o.rows,s=o.cols,d=o.actors,h=r.dirid,p=r.dirname,u=r.delta,v=r.dirhtml,y=$(document.createElement("div"));try{if(y.addClass("Navdir").attr("data-dirid",h).data("dirid",h).attr("data-mapid",a).data("mapid",a).attr("data-displayid",t).data("dsplayid",t),void 0===i.coords[a])return y;var m=i.coords[a].x+u.x,f=i.coords[a].y+u.y,_=convert_xy2i({x:m,y:f},a);if(_>=0&&f>=1&&f<=l&&m>=1&&m<=s){var g,b=get_navtile(c[_]),w=b.tileid,k=b.tilename,j=null===(g=d[_])||void 0===g?void 0:g.wall,S="C"===h?null!=k?k:w:j?"":n?null!=k?k:w:v;y.attr("data-disabled",j).data("disabled",j).attr("data-tileid",w).data("tileid",w).wiki(S)}else y.attr("data-disabled",!0).data("disabled",!0).attr("data-tileid",null).data("tileid",null);return y}catch(e){console.error("".concat(this.name,' - failed to create nav direction "').concat(p,'" for map "').concat(a,'"')),console.error(e)}}function convert_i2xy(e,t){var a=get_navmap(t),r=a.arr,i=a.cols;if(e<0||e>r.length)return{};var n=e%i+1;return{x:n,y:(e-n+1)/i+1}}function convert_xy2i(e,t){var a=get_navmap(t),r=a.rows,i=a.cols,n=e.x,o=e.y;return n<1||n>i||o<1||o>r?-1:(o-1)*i+n-1}config.disable_global||Object.defineProperty(window,config.global_name,{value:Navmap});var dirs_0={C:{dirid:"C",dirname:"center",dirhtml:"",delta:{x:0,y:0}}},dirs_4={N:{dirid:"N",dirname:"north",dirhtml:"🢁",delta:{x:0,y:-1}},E:{dirid:"E",dirname:"east",dirhtml:"🢂",delta:{x:1,y:0}},S:{dirid:"S",dirname:"south",dirhtml:"🢃",delta:{x:0,y:1}},W:{dirid:"W",dirname:"west",dirhtml:"🢀",delta:{x:-1,y:0}}},dirs_8=_objectSpread(_objectSpread({},dirs_4),{},{NW:{dirid:"NW",dirname:"northwest",dirhtml:"🢄",delta:{x:-1,y:-1}},NE:{dirid:"NE",dirname:"northeast",dirhtml:"🢅",delta:{x:1,y:-1}},SE:{dirid:"SE",dirname:"southeast",dirhtml:"🢆",delta:{x:1,y:1}},SW:{dirid:"SW",dirname:"southwest",dirhtml:"🢇",delta:{x:-1,y:1}}}),dirs=_objectSpread(_objectSpread({},dirs_0),dirs_8);function calculate_actors(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"calculate_actors"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.mapid;check_required.call(this,{mapid:i});var n=get_navmap(i),o=n.arr,c=(n.rows,n.cols,n.actors);try{for(var l=0;l<o.length;l++){var s,d,h=get_navtile(o[l]);null!==(d=c[s=l])&&void 0!==d||(c[s]={}),c[l].wall=h.wall}}catch(e){console.error("".concat(this.name,' - failed to calculate actors (tiles) for map "').concat(i,'" (calculate_actors)')),console.error(e)}try{for(var p in naventities){var u,v=naventities[p];if(v.solid&&void 0!==v.coords[i]){var y=convert_xy2i({x:v.coords[i].x,y:v.coords[i].y},i);y<0||null!==(u=c[y])&&void 0!==u&&u.wall||(c[y].wall=v.solid)}}}catch(e){console.error("".concat(this.name,' - failed to calculate actors (entities) for map "').concat(i,'" (calculate_actors)')),console.error(e)}}function new_navmap(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_navmap"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=_objectSpread({diagonal:def.nav.diagonal},e),n=i.source,o=i.mapid,c=i.mapname,l=i.diagonal,s=i.inputtype,d=i.inputmap,h=i.fenced;if(check_required.call(this,{mapid:o}),!d)return this.error("".concat(this.name,"macro"===n?" - missing required macro payload":' - missing required input "inputmap"'));var p=e.cols;check_integer.call(this,{cols:p},{label:"columns"}),check_positive.call(this,{cols:p},{label:"columns"}),def.skipcheck.common||check_oneword.call(this,{mapid:o});try{new Navmap(o,c,s,d,p,l,h)}catch(e){return console.error("".concat(this.name,' - failed to create Navmap object for map "').concat(o,'" (new_navmap)')),this.error(e)}}function new_navtile(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_navtile"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.tileid,n=e.tilename,o=e.tilehtml,c=e.wall;check_required.call(this,{tileid:i}),check_required.call(this,{wall:c});try{var l=get_navtile(i);if(void 0!==l)for(var s in l.wall=c,n&&(l.tilename=n),o){var d,h;if(!def.skipcheck.unused&&void 0===o[s])return this.error("".concat(this.name,' - empty html element / macro payload for tileid "').concat(i,'" on displayid "').concat(s,'"'));l.tilehtml[s]=o[s],null!==(h=(d=l.tilehtml).default)&&void 0!==h||(d.default=i)}else new Navtile(i,n,o,c)}catch(e){return console.error("".concat(this.name,' - failed to create new tile definition for "').concat(i,'" (new_navtile)')),this.error(e)}}function new_navdisplay(e){var t,a,r,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_navdisplay"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var n=e.mapid,o=e.rows_view,c=e.cols_view,l=e.x0,s=e.y0,d=e.entityid_view,h=null!==(i=e.displayid)&&void 0!==i?i:n;if(check_required.call(this,{mapid:n}),!def.skipcheck.clobbering&&get_navdisplay(n,h))return this.error("".concat(this.name,' - display with id "').concat(h,'" already exists for map "').concat(n,'"'));if((check_extant.call(this,{mapid:n}),c&&(check_integer.call(this,{cols_view:c},{label:"view columns"}),check_positive.call(this,{cols_view:c},{label:"view columns"})),o&&(check_integer.call(this,{rows_view:o},{label:"view rows"}),check_positive.call(this,{rows_view:o},{label:"view rows"})),d)&&(check_extant.call(this,{entityid:d},{label:"id of entity to track"}),check_oneword.call(this,{entityid:d},{label:"id of entity to track"}),"undefind"==typeof get_naventity(d).coords[n]))return this.error("".concat(this.name,' - no coordinates set for entity "').concat(d,'" on map "').concat(n,'" (new_navdisplay)'));def.skipcheck.common||check_oneword.call(this,{displayid:h});var p=get_navmap(n),u=p.cols,v=p.rows;try{var y,m,f,_,g,b,w=Math.clamp(1,u,null!==(y=null!=c?c:o)&&void 0!==y?y:u),k=Math.clamp(1,v,null!==(m=null!=o?o:c)&&void 0!==m?m:v);if(void 0!==d){var j=get_naventity(d).coords[n],S=j.x,x=j.y;g=Math.clamp(1,u-c+1,S-Math.floor(c/2)),b=Math.clamp(1,v-o+1,x-Math.floor(o/2))}void 0!==l&&(g=Math.clamp(1,u-c+1,l)),void 0!==s&&(b=Math.clamp(1,v-o+1,s)),navdisplays[h]={displayid:h,mapid:n,entityid_view:d,cols_view:w,rows_view:k,x0:null!==(f=g)&&void 0!==f?f:1,y0:null!==(_=b)&&void 0!==_?_:1}}catch(e){console.error("".concat(this.name," - failed to initialize navdisplay with validated values (new_navdisplay)")),console.error(e)}}function print_navdisplay(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"print_navdisplay"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.displayid;check_required.call(this,{displayid:i}),check_extant.call(this,{displayid:i});var n=get_navdisplay(i);if(0!==$('.Navdisplay[data-display="'.concat(i,'"]')).length)return this.error("".concat(this.name,' - display with id "').concat(i,'" already printed, cannot print the same display twice'));var o=$(document.createElement("div"));try{var c=n.mapid,l=n.entityid_view;n.x0,n.y0,n.cols_view,n.rows_view;o.addClass("Navdisplay").attr("data-mapid",c).data("mapid",c).attr("data-displayid",i).data("displayid",i).attr("data-entityid_view",l).data("entityid_view",l)}catch(e){console.error("".concat(this.name," - failed to intialize $display jQuery object (print_navdisplay)")),console.error(e)}update_navdisplay.call(this,{$display:o});try{setTimeout((function(){o.on(":update_navdisplay",(function(e,t){$(this).children().remove(),update_navdisplay.call(this,{$display:o,delta:t})}))}),40)}catch(e){console.error("".concat(this.name," - failed to assign navdisplay listeners (print_navdisplay)")),console.error(e)}return o}function update_navdisplay(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"update_navdisplay"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.$display,n=e.delta;if(check_required.call(this,{$display:i},{label:"jQuery object holding display to update"}),!def.skipcheck.common&&0===i.length)return this.error("".concat(this.name," - empty jQuery object, no navdisplay supplied"));var o=i.data("displayid"),c=get_navdisplay(o),l=c.mapid,s=get_navmap(l),d=s.arr,h=(s.rows,s.cols);calculate_actors.call(this,{mapid:l}),calculate_navdisplay.call(this,{displayid:o,delta:n});var p=c.x0,u=c.y0,v=c.cols_view,y=c.rows_view;i.css({"grid-template-columns":"repeat(".concat(v,", 1fr)"),"grid-template-rows":"repeat(".concat(y,", 1fr)")});var m=[];try{for(var f=convert_xy2i({x:p,y:u},l),_=1;_<=y;_++)for(var g=1;g<=v;g++){var b=f+(g-1)+h*(_-1),w=d[b],k=print_navtile.call(this,{displayid:o,tile:get_navtile(w),col:g,row:_});k.appendTo(i);var j=convert_i2xy(b,l),S=j.x,x=j.y;k.attr("data-x",S).data("x",S).attr("data-y",x).data("y",x),m.push(b)}}catch(e){console.error("".concat(this.name,' - failed to print tiles for map display "').concat(o,'" (refresh_navdisplay)')),console.error(e)}try{for(var O in naventities){var $=naventities[O];if(void 0!==$.coords[l]){var N=$.coords[l],E=N.x,T=N.y,q=convert_xy2i({x:E,y:T},l);if(m.includes(q))print_naventity.call(this,{displayid:o,entity:$,col:E-p+1,row:T-u+1}).appendTo(i)}}}catch(e){console.error("".concat(this.name,' - failed to print entities for map display "').concat(o,'" (refresh_navdisplay)')),console.error(e)}}function calculate_navdisplay(e){var t=e.displayid,a=e.delta,r=get_navdisplay(t),i=r.mapid,n=(r.entityid_view,get_navmap(i)),o=n.rows,c=n.cols,l=r.x0,s=r.y0,d=r.cols_view,h=r.rows_view;try{var p,u,v,y,m=Math.clamp(1,c,d+(null!==(p=null==a?void 0:a.cols)&&void 0!==p?p:0)),f=Math.clamp(1,o,h+(null!==(u=null==a?void 0:a.rows)&&void 0!==u?u:0)),_=Math.clamp(1,c-m+1,l+Math.floor((d-m)/2)+(null!==(v=null==a?void 0:a.x)&&void 0!==v?v:0)),g=Math.clamp(1,o-f+1,s+Math.floor((h-f)/2)+(null!==(y=null==a?void 0:a.y)&&void 0!==y?y:0));Object.assign(r,{x0:_,y0:g,cols_view:m,rows_view:f})}catch(e){console.error("".concat(this.name,' - failed to calculate new values for display "').concat(t,'" (calculate_navdisplay)')),console.error(e)}}function new_naventity(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_naventity"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.entityid,n=e.entityname,o=e.entityhtml,c=e.solid;check_required.call(this,{entityid:i}),check_required.call(this,{solid:c});try{var l=get_naventity(i);if(void 0!==l)for(var s in l.wall=wall,n&&(l.entityname=n),o){var d,h;if(!def.skipcheck.unused&&void 0===o[s])return this.error("".concat(this.name,' - empty html element / macro payload for entityid "').concat(i,'" on displayid "').concat(s,'"'));l.entityhtml[s]=o[s],null!==(h=(d=l.entityhtml).default)&&void 0!==h||(d.default=i)}else new Naventity(i,n,o,c)}catch(e){return console.error("".concat(this.name,' - failed to create new entity definition for "').concat(i,'" (new_naventity)')),this.error(e)}}function set_naventity(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"set_naventity"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.entityid,n=e.mapid,o=e.x,c=e.y;check_required.call(this,{entityid:i}),check_required.call(this,{mapid:n}),check_required.call(this,{x:o}),check_required.call(this,{y:c}),check_extant.call(this,{entityid:i}),check_extant.call(this,{mapid:n}),check_integer.call(this,{x:o}),check_integer.call(this,{y:c}),def.skipcheck.common||(check_xbound.call(this,{mapid:n,x:o}),check_ybound.call(this,{mapid:n,y:c}));try{get_naventity(i).coords[n]={x:o,y:c}}catch(e){return console.error("".concat(this.name,' - failed to set entity "').concat(i,'" on map "').concat(n,'" (set_naventity)')),this.error(e)}try{$('.Navdisplay[data-mapid="'.concat(n,'"]')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(n,'"]')).trigger(":update_navrose")}catch(e){console.error("".concat(this.name,' - failed to update navdisplays while setting entity "').concat(i,'" on map "').concat(n,'" (set_naventity)')),console.error(e)}}function rem_naventity(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"rem_naventity"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.entityid,n=e.mapid;check_required.call(this,{entityid:i}),check_required.call(this,{mapid:n}),def.skipcheck.common||(check_extant.call(this,{entityid:i}),check_extant.call(this,{mapid:n}));try{delete get_naventity(i).coords[n]}catch(e){console.error("".concat(this.name,' - failed to remove naventity "').concat(i,'" from map "').concat(n,'" (rem_naventity)')),console.error(e)}try{$('.Navdisplay[data-mapid="'.concat(n,'"]')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(n,'"]')).trigger(":update_navrose")}catch(e){console.error("".concat(this.name,' - failed to update navdisplays while removing entity "').concat(i,'" on map "').concat(n,'" (set_naventity)')),console.error(e)}}function mov_naventity(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"set_naventity"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=_objectSpread({trigger_update:!0},e),n=i.entityid,o=i.mapid,c=i.delta,l=i.ignore_walls,s=i.trigger_update;check_required.call(this,{entityid:n}),check_required.call(this,{mapid:o}),check_required.call(this,{delta:c}),check_extant.call(this,{entityid:n}),check_extant.call(this,{mapid:o});var d,h,p=get_navmap(o),u=p.fenced,v=p.rows,y=p.cols,m=p.actors,f=get_naventity(n),_=f.coords[o],g=_.x,b=_.y;def.skipcheck.common||u||(check_xbound.call(this,{mapid:o,x:g+(null!==(d=null==c?void 0:c.x)&&void 0!==d?d:0)},{label:"current x position + input delta x"}),check_ybound.call(this,{mapid:o,y:b+(null!==(h=null==c?void 0:c.y)&&void 0!==h?h:0)},{label:"current y position + input delta y"}));try{var w,k,j,S,x,O=u?Math.clamp(1,y,g+(null!==(w=null==c?void 0:c.x)&&void 0!==w?w:0)):g+(null!==(k=null==c?void 0:c.x)&&void 0!==k?k:0),N=u?Math.clamp(1,v,b+(null!==(j=null==c?void 0:c.y)&&void 0!==j?j:0)):b+(null!==(S=null==c?void 0:c.y)&&void 0!==S?S:0);null!==(x=m[convert_xy2i({x:O,y:N},o)])&&void 0!==x&&x.wall&&!l||(f.coords[o].x=O,f.coords[o].y=N)}catch(e){return console.error("".concat(this.name,' - failed to move entity "').concat(n,'" on map "').concat(o,'" (mov_naventity)')),this.error(e)}try{s&&($('.Navdisplay[data-mapid="'.concat(o,'"]')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(o,'"]')).trigger(":update_navrose"))}catch(e){console.error("".concat(this.name,' - failed to trigger updates while moving entity "').concat(n,'" on map "').concat(o,'" (mov_naventity)')),console.error(e)}}function print_navrose(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"set_naventity"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=_objectSpread({print_names:def.nav.print_names,keyboard_codes:def.nav.keyboard_codes},e),n=i.displayid,o=i.entityid,c=i.print_names,l=i.keyboard_codes;check_required.call(this,{displayid:n}),check_required.call(this,{entityid:o}),check_extant.call(this,{entityid:o}),check_extant.call(this,{displayid:n});var s=get_navdisplay(n),d=s.mapid;s.cols_view,s.rows_view,s.x0,s.y0,get_naventity(o);def.skipcheck.common;var h=get_navmap(d).diagonal,p=$(document.createElement("div")),u=crypto.randomUUID();try{p.addClass("Navrose").attr("data-mapid",d).data("mapid",d).attr("data-displayid",n).data("displayid",n).attr("data-print_names",c).data("print_names",c).attr("data-entityid",o).data("entityid",o).attr("data-navsn",u).data("navsn",u)}catch(e){console.error("".concat(this.name,' - failed to initialize nav rose for display "').concat(n,'" (print_navrose)')),console.error(e)}update_navrose.call(this,{$rose:p});try{setTimeout((function(){p.on(":update_navrose",(function(e){$(this).children().remove(),update_navrose.call(this,{$rose:p})})),p.on("click",(function(e){click_navrose.call(this,{displayid:n,mapid:d,entityid:o,ev:e})}))}),40)}catch(e){console.error("".concat(this.name,' - failed to assign navrose listeners for navrose with displayid "').concat(n,'" (print_navrose)')),console.error(e)}try{var v=h?dirs_8:dirs_4;setTimeout((function(){$(document).on("keydown.".concat(u),(function(e){if(console.log(e.code),0===$('[data-navsn="'.concat(u,'"]')).length)$(document).off("keydown.".concat(u)),console.log("off!");else for(var t in v)e.code===l[t]&&$('[data-navsn="'.concat(u,'"] .Navdir[data-dirid="').concat(t,'"]')).trigger("click")}))}),40)}catch(e){console.error("".concat(this.name,' - failed to create key press listeners for navrose with displayid "').concat(n,'"')),console.error(e)}return p}function update_navrose(e){var t,a,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"update_navrose"),null!==(r=this.error)&&void 0!==r||(this.error=function(e){throw new Error(e)});var i=e.$rose;if(check_required.call(this,{$rose:i},{label:"jQuery object holding navrose"}),!def.skipcheck.common&&0===i.length)return this.error("".concat(this.name," - empty jQuery object, no navrose provided"));var n=i.data("mapid"),o=i.data("displayid"),c=i.data("entityid"),l=i.data("print_names"),s=get_navmap(n).diagonal,d=get_naventity(c);try{var h=_objectSpread(_objectSpread({},dirs_0),s?dirs_8:dirs_4);for(var p in h){print_navdir.call(this,{displayid:o,mapid:n,dir:h[p],entity:d,print_names:l}).appendTo(i)}}catch(e){console.error("".concat(this.name," - failed to update navrose (update_navrose)")),console.error(e)}}function click_navrose(e){var t=e.displayid,a=e.mapid,r=e.entityid,i=e.ev,n=$(i.target);if(n.hasClass("Navdir")){var o=n.data("dirid");if(!n.data("disabled")){var c=dirs[o].delta;mov_naventity.call(this,{entityid:r,mapid:a,delta:c,trigger_update:!1});var l=get_navmap(a),s=get_navdisplay(t),d=get_naventity(r),h=l.cols,p=l.rows,u=s.cols_view,v=s.rows_view,y=d.coords[a],m=y.x,f=y.y,_=s.x0,g=s.y0,b=Math.clamp(1,h-u+1,m-Math.floor(u/2)),w=Math.clamp(1,p-v+1,f-Math.floor(v/2));$('.Navdisplay[data-displayid="'.concat(t,'"]')).trigger(":update_navdisplay",{x:b-_,y:w-g}),$('.Navdisplay[data-mapid="'.concat(a,'"]:not([data-displayid="').concat(t,'"])')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(a,'"]')).trigger(":update_navrose")}}}Macro.add(["newnavmap","new_navmap"],{tags:null,handler:function(){debug.log("macro","begin - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{mapid:{type:"string",alias:"map"},mapname:{type:"string",alias:"name"},cols:{type:"number",alias:"columns"},diagonal:{type:"boolean"},fenced:{type:"boolean"}}});e.inputtype="array",e.inputmap=this.payload[0].contents.trim().split(/[\s\n]+/g),e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),new_navmap.call(this,e)}}),Macro.add(["newnavtile","new_navtile"],{tags:["displayhtml","display_html"],handler:function(){debug.log("macro","begin - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{tileid:{type:"string",alias:"tile"},tilename:{type:"string",alias:"name"},wall:{type:"boolean"}}});if(e.tilehtml={},e.tilehtml.default=this.payload[0].contents.trim(),this.payload.length>1)for(var t=1;t<this.payload.length;t++){var a,r,i=create_argObj.call(this,{id:this.name,args_in:this.payload[t].args,template:{displayid:{type:"string",alias:"display"}}}).displayid;if(!def.skipcheck.clobbering&&void 0!==e.tilehtml[i])return this.error("".concat(this.name,' - clobbering, child tag with display id "').concat(i,'" already used in this macro call'));e.tilehtml[i]=null===(a=this.payload[t])||void 0===a||null===(r=a.contents)||void 0===r?void 0:r.trim()}e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),new_navtile.call(this,e)}}),Macro.add(["new_navdisplay","newnavdisplay"],{handler:function(){debug.log("macro","begin - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{mapid:{type:"string",alias:"map"},displayid:{type:"string",alias:"display"},cols_view:{type:"number",alias:["viewcolumns","cols","columns"]},rows_view:{type:"number",alias:["viewrows","rows"]},x0:{type:"number"},y0:{type:"number"},entityid_view:{type:"string",alias:["viewentity","entityid"]}}});e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),new_navdisplay.call(this,e)}}),Macro.add(["print_navdisplay","printnavdisplay"],{handler:function(){debug.log("macro","start - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{displayid:{type:"string",alias:"display"}}});e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),print_navdisplay.call(this,e).appendTo(this.output)}}),Macro.add(["newnaventity","new_naventity"],{tags:["displayhtml","display_html"],handler:function(){debug.log("macro","start - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},entityname:{type:"string",alias:"name"},solid:{type:"boolean"}}});if(e.entityhtml={},e.entityhtml.default=this.payload[0].contents.trim(),this.payload.length>1)for(var t=1;t<this.payload.length;t++){var a,r,i=create_argObj.call(this,{id:this.name,args_in:this.payload[t].args,template:{displayid:{type:"string",alias:"display"}}}).displayid;if(!def.skipcheck.clobbering&&void 0!==e.entityhtml[i])return this.error("".concat(this.name,' - clobbering, child tag with display id "').concat(i,'" already used in this macro call'));e.entityhtml[i]=null===(a=this.payload[t])||void 0===a||null===(r=a.contents)||void 0===r?void 0:r.trim()}e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),new_naventity.call(this,e)}}),Macro.add(["setnaventity","set_naventity"],{handler:function(){debug.log("macro","start - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},mapid:{type:"string",alias:"map"},x:{type:"number"},y:{type:"number"}}});e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),set_naventity.call(this,e)}}),Macro.add(["remnaventity","rem_naventity"],{handler:function(){debug.log("macro","start - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},mapid:{type:"string",alias:"map"}}});e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),rem_naventity.call(this,e)}}),Macro.add(["movnaventity","mov_naventity"],{handler:function(){debug.log("macro","start - ".concat(this.name," handler"));var e,t,a,r=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},mapid:{type:"string",alias:"map"},delta:{type:"object"},deltax:{type:"number"},deltay:{type:"number"},ignore_walls:{type:"boolean"}}});void 0===r.deltax&&void 0===r.deltay||(null!==(e=r.delta)&&void 0!==e||(r.delta={}),r.delta.x=null!==(t=r.deltax)&&void 0!==t?t:0,r.delta.y=null!==(a=r.deltay)&&void 0!==a?a:0);r.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",r),mov_naventity.call(this,r)}}),Macro.add(["print_navrose","printnavrose"],{handler:function(){debug.log("macro","start - ".concat(this.name," handler"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{displayid:{type:"string",alias:"display"},entityid:{type:"string",alias:"entity"},print_names:{type:"boolean",alias:"names"},keyboard_codes:{type:"object",alias:"codes"},keyboard_N:{type:"string",alias:"code_N"},keyboard_E:{type:"string",alias:"code_E"},keyboard_S:{type:"string",alias:"code_S"},keyboard_W:{type:"string",alias:"code_W"},keyboard_NW:{type:"string",alias:"code_NW"},keyboard_NE:{type:"string",alias:"code_NE"},keyboard_SE:{type:"string",alias:"code_SE"},keyboard_SW:{type:"string",alias:"code_SW"}}});try{var t;for(var a in null!==(t=e.keyboard_codes)&&void 0!==t||(e.keyboard_codes={}),dirs_8)void 0!==e["keyboard_".concat(a)]&&(e.keyboard_codes[a]=e["keyboard_".concat(a)])}catch(e){console.error("".concat(this.name," - failed to parse keyboard code shorthands into keyboard_codes object (<<print_navrose>>)")),console.error(e)}e.source="macro",debug.log("macro","end - ".concat(this.name," handler")),debug.log("macro",e),print_navrose.call(this,e).appendTo(this.output)}}),UIBar.destroy();