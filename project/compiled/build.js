"use strict";var _setup,_config$setup_name,_setup$_config$setup_,_State$variables,_config$State_name,_State$variables$_con,_navtiles,_State$variables$conf,_State$variables$conf2,_State$variables$conf5,_State$variables$conf6,_State$variables$conf7,_State$variables$conf8,_State$variables$conf11,_State$variables$conf12;function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){_defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classPrivateMethodInitSpec(e,t){_checkPrivateRedeclaration(e,t),t.add(e)}function _checkPrivateRedeclaration(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateMethodGet(e,t,a){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return a}var debug={on:{proxy:!1,argObj:!1,macro:!1,collision:!1,segment:!1},log:function(e,t){(e=Array.isArray(e)?e:[e]).filter((function(e){return debug.on[e]})).length&&console.log(t)}},_add_arr=new WeakSet,_add_obj=new WeakSet,_push=new WeakSet,TypeSet=function(){function e(){_classCallCheck(this,e),_classPrivateMethodInitSpec(this,_push),_classPrivateMethodInitSpec(this,_add_obj),_classPrivateMethodInitSpec(this,_add_arr),this.any=[],this.exact=[],this.other=[],this.label=null,this["this is a TypeSet"]=!0;try{for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];for(var n=0,r=a;n<r.length;n++){var o=r[n];this.add(o)}}catch(e){console.error("failed to create TypeSet object")}}return _createClass(e,[{key:"print",get:function(){if(this.label)return this.label;var t,a=[],i=_createForOfIteratorHelper(this.any);try{for(i.s();!(t=i.n()).done;){var n=t.value;"undefined"===n||"null"===n?a.push("".concat(n)):a.push("any '".concat(n,"'"))}}catch(e){i.e(e)}finally{i.f()}var r,o=_createForOfIteratorHelper(this.exact);try{for(o.s();!(r=o.n()).done;){var l=r.value;a.push("exactly the ".concat(e.id(l)," '").concat(l,"'"))}}catch(e){o.e(e)}finally{o.f()}return a.join(" or ")}},{key:"add",value:function(t){try{if("array"===e.id(t))_classPrivateMethodGet(this,_add_arr,_add_arr2).call(this,t);else if("object"===e.id(t))_classPrivateMethodGet(this,_add_obj,_add_obj2).call(this,t);else if("string"==typeof t)_classPrivateMethodGet(this,_push,_push2).call(this,t,"any");else{var a='TypeSet - invalid input "'.concat(t,"\", must be 'string' or 'object' or 'array'");console.error(a)}}catch(a){console.error("failed to add ".concat(t," to TypeSet; check 'TypeSet.valid' for valid types")),console.error(a)}}},{key:"has",value:function(t){var a=!1;if("object"!==e.id(t)||1!==Object.keys(t).length||"any"!==Object.keys(t)[0]&&"exact"!==Object.keys(t)[0]&&"other"!==Object.keys(t)[0])for(var i=0,n=[].concat(_toConsumableArray(this.any),_toConsumableArray(this.exact));i<n.length;i++){if(t===n[i]){a=!0;break}}else for(var r=0,o=["any","exact","other"];r<o.length;r++){var l,c=o[r],s=Object.values(t)[0],d=_createForOfIteratorHelper(this[c]);try{for(d.s();!(l=d.n()).done;){if(s===l.value){a=!0;break}}}catch(e){d.e(e)}finally{d.f()}if(a=!0)break}return a}},{key:"accepts",value:function(t){var a=!1;if(this.other.includes("any")&&(a=!0),!a){var i,n=_createForOfIteratorHelper(this.any);try{for(n.s();!(i=n.n()).done;){var r=i.value;if(e.id(t)===r){a=!0;break}}}catch(e){n.e(e)}finally{n.f()}}if(!a){var o,l=_createForOfIteratorHelper(this.exact);try{for(l.s();!(o=l.n()).done;){if(t===o.value){a=!0;break}}}catch(e){l.e(e)}finally{l.f()}}return a}}],[{key:"validate",value:function(t){if(!e.valid.includes(t)){var a='TypeSet - "'.concat(t,"\" is not a valid type; use 'TypeSet.valid' to get the array of valid types; use exact to add the exact value");throw new Error(a)}}},{key:"valid",get:function(){return["string","number","object","boolean","undefined","array","null"]}},{key:"id",value:function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}},{key:"isTypeSet",value:function(e){return"object"===_typeof(e)&&!!e["this is a TypeSet"]}}]),e}();function _add_arr2(e,t){if(0===e.length){console.error("TypeSet - array input cannot be empty")}var a,i=_createForOfIteratorHelper(e);try{for(i.s();!(a=i.n()).done;){var n=a.value;t?_classPrivateMethodGet(this,_push,_push2).call(this,n,t):this.add(n)}}catch(e){i.e(e)}finally{i.f()}}function _add_obj2(e){for(var t in e)if("any"!==t&&"exact"!==t&&"other"!==t||"array"!==TypeSet.id(e[t]))if("any"===t||"exact"===t||"other"===t)_classPrivateMethodGet(this,_push,_push2).call(this,e[t],t);else if("label"===t){if("string"!==TypeSet.id(e[t])){var a='TypeSet - input for label "'.concat(e[t],"\" ('").concat(TypeSet.id(e[t]),"') should be a string instead");console.error(a)}this.label=e[t]}else{var i="TypeSet - unexpected object key ".concat(t);console.error(i)}else _classPrivateMethodGet(this,_add_arr,_add_arr2).call(this,e[t],t)}function _push2(e,t){try{if(this[t].includes(e))return;if("any"===t)TypeSet.validate(e),this.any.push(e);else if("exact"===t)this.exact.push(e);else if("any"===e)this.other.push(e);else{var a="TypeSet - unexpected input for ".concat(t,'-type "').concat(e,'"');console.error(a)}}catch(a){console.error("failed to push ".concat(t,"-type to TypeSet at arg ").concat(e)),console.error(a)}}function create_argObj(e){if(void 0===e)throw new Error("".concat(this.name," - failed, missing input (create_argObj)"));var t=e.id,a=e.template,i=e.options,n=clone(e.args_in);if(void 0===t)throw new Error("".concat(this.name," - failed, missing required id (create_argObj)"));if(void 0===a)throw new Error("".concat(t," - failed, missing required template (create_argObj)"));if(void 0===n)throw new Error("".concat(t," - failed, missing required args_in (create_argObj)"));var r=Object.keys(a);if(!r.length)throw new Error("".concat(t," - failed, template can't be empty (create_argObj)"));var o={};try{for(var l=0,c=r;l<c.length;l++){var s=c[l];if(o[s]=s,void 0!==a[s].alias)if("array"===TypeSet.id(a[s].alias)){var d,p=_createForOfIteratorHelper(a[s].alias);try{for(p.s();!(d=p.n()).done;){var h=d.value;if(void 0!==o[h])throw new Error("".concat(t," - failed, clobbering alias ").concat(h," (create_argObj)"));o[h]=s}}catch(e){p.e(e)}finally{p.f()}}else{if(void 0!==o[a[s].alias])throw new Error("".concat(t," - failed, clobbering alias ").concat(a[s].alias," (create_argObj)"));o[a[s].alias]=s}}}catch(e){console.error("".concat(t," - failed to create aliases while parsing macro arguments (create_argObj)")),console.error(e)}var v={},u={id:t,args_in:n,template:a,keys:r,output:v,alias:o,options:i,splice:0};try{for(;u.args_in.length>0;){debug.log("argObj","entered loop"),debug.log("argObj",u),u.splice=0;var y=u.args_in[0];try{0===u.splice&&r.includes(o[y])&&argObj_kvp.call(this,u),0===u.splice&&y.isLink&&argObj_markup.call(this,u),0===u.splice&&"object"===TypeSet.id(y)&&argObj_obj.call(this,u);var m=_objectSpread({strict:!1},i).strict;if(0!==u.splice||m||argObj_lazy.call(this,u),!(u.splice>0))return console.error(v),this.error("".concat(t,' - unexpected input "').concat(y,'", is not a key name and did not match any valid types'));u.args_in.splice(0,u.splice)}catch(e){console.error("".concat(t,' - failed to create argObj at "').concat(y,'" for "').concat(t,'" (create_argObj)')),console.error(e)}}return v}catch(e){console.error("".concat(t," - failed to create argObj from macro arguments (create_argObj)")),console.error(e)}}function argObj_markup(e){debug.log("argObj","entered markup"),debug.log("argObj",e);var t=e.id,a=e.args_in,i=e.keys,n=e.output,r=a[0];try{return i.includes("passage")?(n.linktext=r.text,n.passage=r.link,e.splice=1,e):this.error("".concat(t," - macro does not accept [[markup]]"))}catch(e){console.error("".concat(t," - failed to parse macro arguments inside [[markup]] parser (argObj_markup)")),console.error(e)}}function argObj_kvp(e){debug.log("argObj","entered kvp"),debug.log("argObj",e);var t=e.id,a=e.args_in,i=e.template,n=e.output,r=e.alias,o=a[0],l=a[1];try{if("undefined"===TypeSet.id(l))return this.error("".concat(t,' - no input was found for argument "').concat(o,'"'));var c=new TypeSet(i[r[o]].type);return c.accepts(l)?(n[r[o]]=l,e.splice=2,e):this.error("".concat(t,' - "').concat(l,"\" is an invalid type ('").concat(TypeSet.id(l),"') for \"").concat(o,'", expected ').concat(c.print))}catch(e){console.error("".concat(t," - failed to parse macro arguments inside KVP parser (argObj_kvp)")),console.error(e)}}function argObj_obj(e){debug.log("argObj","entered object parser"),debug.log("argObj",e);var t=e.id,a=e.args_in,i=e.template,n=e.keys,r=e.output,o=e.alias,l=a[0];try{for(var c in l)if(n.includes(o[c])){var s=new TypeSet(i[o[c]].type);if(!s.accepts(l[c]))return this.error("".concat(t,' - "').concat(l[c],'" is an invalid type for "').concat(c,"\" ('").concat(TypeSet.id(l[c]),"'), expected ").concat(s.print));r[o[c]]=l[c],e.splice=1}return e}catch(e){console.error("".concat(t," - failed to parse macro arguments inside object parser (argObj_obj)")),console.error(e)}}function argObj_lazy(e){debug.log("argObj","entered lazy matcher"),debug.log("argObj",e);var t=e.id,a=e.args_in,i=e.template,n=e.keys,r=e.output,o=a[0];try{var l=n.filter((function(e){return!Object.keys(r).includes(e)}));if(!l.length)return e;var c,s=_createForOfIteratorHelper(l);try{for(s.s();!(c=s.n()).done;){var d=c.value;if(new TypeSet(i[d].type).accepts(o)){r[d]=o,e.splice=1;break}}}catch(e){s.e(e)}finally{s.f()}return e}catch(e){console.error("".concat(t," - failed to parse macro arguments inside lazy parser (argObj_lazy)")),console.error(e)}}var config={nav:{},empty:{},floor:{},display:{},entity:{},skipcheck:{}};config.nav.diagonal=!1,config.nav.print_names=!1,config.nav.codes={N:"Numpad8",E:"Numpad6",S:"Numpad2",W:"Numpad4",NW:"Numpad7",NE:"Numpad9",SE:"Numpad3",SW:"Numpad1"},config.nav.ignore={holes:!1,walls:!1,entities:!1},config.entity.solid=!0,config.display.print_tiles=!1,config.empty.tileid=".",config.floor.tileid="x",config.skipcheck.clobbering=!1,config.skipcheck.common=!1,config.skipcheck.unused=!1,config.disable_global=!1,config.setup_name="@navmap",config.global_name="Navmap",config.State_name="@navmap",null!==(_setup$_config$setup_=(_setup=setup)[_config$setup_name=config.setup_name])&&void 0!==_setup$_config$setup_||(_setup[_config$setup_name]={}),null!==(_State$variables$_con=(_State$variables=State.variables)[_config$State_name=config.State_name])&&void 0!==_State$variables$_con||(_State$variables[_config$State_name]={});var def=new Proxy(config,get_controller(setup[config.setup_name]));function get_controller(e){return{get:function(t,a){return debug.log("proxy","---- start proxy ----"),debug.log({t:t,p:a}),void 0===e||void 0===e[a]?(debug.log("proxy","entered undefined"),debug.log("proxy","---- end proxy ----"),t[a]):(debug.log("proxy","entered defined"),"object"!==_typeof(e[a])||e[a].isproxy||(debug.log("proxy","created proxy"),e[a]=new Proxy(config[a],get_controller(e[a])),e[a].isproxy=!0),debug.log("proxy","---- end proxy ----"),e[a])}}}var navmaps={},naventities={},navtiles=(_defineProperty(_navtiles={},String(def.empty.tileid),{tileid:String(def.empty.tileid),tilename:def.empty.tileid,tilehtml:{default:def.empty.tileid},hole:!0}),_defineProperty(_navtiles,String(def.floor.tileid),{tileid:String(def.floor.tileid),tilename:def.floor.tileid,tilehtml:{default:def.floor.tileid},hole:!1}),_navtiles),navdisplays={},navwalls={};function get_navmap(e){return navmaps[e]}function get_navtile(e){return navtiles[e]}function get_naventity(e){return naventities[e]}function get_navdisplay(e){return navdisplays[e]}function get_navwall(e){return navwalls[e]}setup.navmaps=navmaps,setup.navtiles=navtiles,setup.naventities=naventities,setup.navdisplays=navdisplays,setup.navwalls=navwalls,null!==(_State$variables$conf2=(_State$variables$conf=State.variables[config.State_name]).navmaps)&&void 0!==_State$variables$conf2||(_State$variables$conf.navmaps={});var Navmap=function(){function e(t,a,i,n,r,o,l){var c,s,d;_classCallCheck(this,e),this.error=function(e){throw new Error(e)},!def.skipcheck.clobbering&&navmaps[t]&&console.error('Navmap - clobbering, map with id "'.concat(t,'" already exists')),navmaps[String(t)]=this,this.mapid=String(t),null!==(d=(c=State.variables[config.State_name].navmaps)[s=this.mapid])&&void 0!==d||(c[s]={}),this.mapname=null!=a?a:this.mapid,this.diagonal=null!=o?o:def.nav.diagonal,this.maphtml=null!=l?l:{};try{if(void 0===this.arr||void 0===this.cols||void 0===this.rows){if("array"===i){if(this.arr=n,this.cols=r,void 0===r)return this.error('Navmap - missing required input "cols" or "columns" for map "'.concat(this.mapid,'"'));if("array"===i&&this.arr%this.cols)return console.error(n),this.error("Navmap - inputmap is not rectangular")}else{if("2D array"!==i)return this.error('Navmap - invalid inputtype for map "'.concat(this.mapid,"\", only macro payload or 'array' or '2D array' is supported"));this.cols=n[0].length;var p,h=_createForOfIteratorHelper(n);try{for(h.s();!(p=h.n()).done;){var v=p.value;if(!Array.isarray(v))return console.error(v),this.error('Navmap - invalid inputmap, non-array detected for map "'.concat(this.mapid,'"'));if(0===(null==v?void 0:v.length)||(null==v?void 0:v.length)!==this.cols)return console.error(v),this.error('Navmap - invalid inputmap, non-rectangular input detected for map "'.concat(this.mapid,'"'))}}catch(e){h.e(e)}finally{h.f()}this.arr=n.flat()}this.rows=this.arr.length/this.cols}}catch(e){return console.error('Navmap - failed to parse input for inputtype "'.concat(i,'" and inputmap (Navmap)')),console.error(n),this.error(e)}try{var u,y=_createForOfIteratorHelper(new Set(this.arr));try{for(y.s();!(u=y.n()).done;){var m=u.value;void 0===get_navtile(m)&&console.error('Navmap - tile "'.concat(m,'" is undefined — navtile definitions should come before maps that use them'))}}catch(e){y.e(e)}finally{y.f()}}catch(e){console.error('Navmap - failed to create default Navtiles for map "'.concat(this.mapid,'"')),console.error(e)}this.cells=[],init_cells.call({},{mapid:t})}return _createClass(e,[{key:"arr",get:function(){return State.variables[config.State_name].navmaps[this.mapid].arr},set:function(e){State.variables[config.State_name].navmaps[this.mapid].arr=e}}]),e}();null!==(_State$variables$conf6=(_State$variables$conf5=State.variables[config.State_name]).navtiles)&&void 0!==_State$variables$conf6||(_State$variables$conf5.navtiles={});var Navtile=_createClass((function e(t,a,i,n){var r,o;for(var l in _classCallCheck(this,e),this.error=function(e){throw new Error(e)},!def.skipcheck.clobbering&&navtiles[t]&&console.error('Navtile - clobbering, tile with id "'.concat(t,'" already exists')),navtiles[String(t)]=this,this.tileid=String(t),this.tilename=null!=a?a:t,this.hole=null!=n&&n,this.tilehtml={},i)this.tilehtml[l]=i[l];null!==(o=(r=this.tilehtml).default)&&void 0!==o||(r.default=t)}));null!==(_State$variables$conf8=(_State$variables$conf7=State.variables[config.State_name]).naventities)&&void 0!==_State$variables$conf8||(_State$variables$conf7.naventities={});var Naventity=function(){function e(t,a,i,n){var r,o,l,c,s,d;for(var p in _classCallCheck(this,e),this.error=function(e){throw new Error(e)},!def.skipcheck.clobbering&&naventities[t]&&console.error('Naventity - clobbering, entity with id "'.concat(t,'" already exists')),naventities[String(t)]=this,this.entityid=String(t),null!==(l=(r=State.variables[config.State_name].naventities)[o=this.entityid])&&void 0!==l||(r[o]={}),this.entityname=null!=a?a:t,this.solid=null!=n?n:def.entity.solid,null!==(c=this.points)&&void 0!==c||(this.points={}),this.entityhtml={},i)this.entityhtml[p]=i[p];null!==(d=(s=this.entityhtml).default)&&void 0!==d||(s.default=t)}return _createClass(e,[{key:"points",get:function(){return State.variables[config.State_name].naventities[this.entityid].points},set:function(e){State.variables[config.State_name].naventities[this.entityid].points=e}}]),e}();null!==(_State$variables$conf12=(_State$variables$conf11=State.variables[config.State_name]).navwalls)&&void 0!==_State$variables$conf12||(_State$variables$conf11.navwalls={});var Navwall=function(){function e(t,a,i){var n,r,o,l;_classCallCheck(this,e),this.error=function(e){throw new Error(e)},!def.skipcheck.clobbering&&navwalls[t]&&console.error('Naventity - clobbering, entity with id "'.concat(entityid,'" already exists')),navwalls[String(t)]=this,this.wallid=String(t),null!==(o=(n=State.variables[config.State_name].navwalls)[r=this.wallid])&&void 0!==o||(n[r]={}),this.wallhtml=i,null!==(l=this.points)&&void 0!==l||(this.points={})}return _createClass(e,[{key:"points",get:function(){return State.variables[config.State_name].navwalls[this.wallid].points},set:function(e){State.variables[config.State_name].navwalls[this.wallid].points=e}}]),e}();function check_required(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_required)"));if(Object.keys(e).length>1)return this.error("".concat(this.name," - failed extra properties in argObj_in (check_required)"));try{var a,i=Object.keys(e)[0];if(void 0===e[i])return this.error("".concat(this.name,' - missing required argument "').concat(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:i,'"'))}catch(e){console.error("".concat(this.name," - failed to check for required args")),console.error(e)}}function check_extant(e,t){if(void 0===e)return this.error("".concat(this.name," - failed, missing argObj_in (check_extant)"));if(Object.keys(e).length>1)return this.error("".concat(this.name," - failed extra properties in argObj_in (check_extant)"));try{var a=Object.keys(e)[0],i=e[a];if("mapid"===a&&void 0===get_navmap(i))return this.error("".concat(this.name,' - no map with id "').concat(i,'" found'));if("tileid"===a&&void 0===get_navtile(i))return this.error("".concat(this.name,' - no tile with id "').concat(i,'" found'));if("entityid"===a&&void 0===get_naventity(i))return this.error("".concat(this.name,' - no entity with id "').concat(i,'" found'));if("displayid"===a&&void 0===get_navdisplay(i)){if(void 0===get_navmap(i))return this.error("".concat(this.name,' - no display with id "').concat(i,'" found'));new_navdisplay.call(this,{mapid:displayid})}"wallid"===a&&void 0===get_navwall(i)&&new_navwall.call(this,{wallid:i})}catch(e){console.error("".concat(this.name," - failed to check args for extant requirement")),console.error(e)}}function print_navtile(e){var t=e.displayid,a=e.tile,i=e.row,n=e.col,r=a.tileid,o=a.tilename,l=a.hole,c=a.tilehtml;try{var s=$(document.createElement("div")),d=void 0===c?r:void 0!==c[t]?c[t]:void 0!==c.default?c.default:r;return s.addClass("Navtile").attr("title",o).attr("data-tileid",r).data("tileid",r).attr("data-hole",l).data("hole",l).css({"grid-column":"".concat(n," / span 1"),"grid-row":"".concat(i," / span 1")}).wiki(d),s}catch(e){console.error("".concat(this.name,' - failed to print navtile element on navdisplay "').concat(t,'"')),console.error(e)}}function print_naventity(e){var t=e.displayid,a=e.entity,i=e.col,n=e.row,r=a.entityid,o=a.entityname,l=a.entityhtml;try{var c=$(document.createElement("div")),s=void 0===l?r:void 0!==l[t]?l[t]:void 0!==l.default?l.default:r;return c.addClass("Naventity").attr("title",o).attr("data-entityid",r).data("entityid",r).css({"grid-column":"".concat(i," / span 1"),"grid-row":"".concat(n," / span 1")}).wiki(s),c}catch(e){console.error("".concat(this.name,' - failed to create entity element for "').concat(r,'" on "').concat(mapid,'"')),console.error(e)}}function print_navdir(e){var t=e.displayid,a=e.mapid,i=e.dir,n=e.entity,r=e.print_names,o=get_navmap(a),l=o.arr,c=o.rows,s=o.cols,d=o.cells,p=i.dirid,h=i.dirname,v=i.delta,u=i.dirhtml,y=$(document.createElement("div"));try{if(y.addClass("Navdir").attr("data-dirid",p).data("dirid",p).attr("data-mapid",a).data("mapid",a).attr("data-displayid",t).data("dsplayid",t),void 0===n.points[a])return y;var m=n.points[a].x+v.x,g=n.points[a].y+v.y,f=convert_xy2i({x:m,y:g},a);if(f>=0&&g>=1&&g<=c&&m>=1&&m<=s){var _=get_navtile(l[f]),b=_.tileid,w=_.tilename,x=d[m][g].blocked,k="C"===p?null!=w?w:b:x?"":r?null!=w?w:b:u;y.attr("data-disabled",x).data("disabled",x).attr("data-tileid",b).data("tileid",b).wiki(k)}else y.attr("data-disabled",!0).data("disabled",!0).attr("data-tileid",null).data("tileid",null);return y}catch(e){console.error("".concat(this.name,' - failed to create nav direction "').concat(h,'" for map "').concat(a,'"')),console.error(e)}}function convert_i2xy(e,t){var a=get_navmap(t),i=a.arr,n=a.cols;if(e<0||e>i.length)return{};var r=e%n+1;return{x:r,y:(e-r+1)/n+1}}function convert_xy2i(e,t){var a=get_navmap(t),i=a.rows,n=a.cols,r=e.x,o=e.y;return r<1||r>n||o<1||o>i?-1:(o-1)*n+r-1}config.disable_global||Object.defineProperty(window,config.global_name,{value:Navmap});var dirs_0={C:{dirid:"C",dirname:"center",dirhtml:"",delta:{x:0,y:0}}},dirs_4={N:{dirid:"N",dirname:"north",dirhtml:"🢁",delta:{x:0,y:-1}},E:{dirid:"E",dirname:"east",dirhtml:"🢂",delta:{x:1,y:0}},S:{dirid:"S",dirname:"south",dirhtml:"🢃",delta:{x:0,y:1}},W:{dirid:"W",dirname:"west",dirhtml:"🢀",delta:{x:-1,y:0}}},dirs_8=_objectSpread(_objectSpread({},dirs_4),{},{NW:{dirid:"NW",dirname:"northwest",dirhtml:"🢄",delta:{x:-1,y:-1}},NE:{dirid:"NE",dirname:"northeast",dirhtml:"🢅",delta:{x:1,y:-1}},SE:{dirid:"SE",dirname:"southeast",dirhtml:"🢆",delta:{x:1,y:1}},SW:{dirid:"SW",dirname:"southwest",dirhtml:"🢇",delta:{x:-1,y:1}}});function compare_segments(e,t,a,i){debug.log("segment","---- start segment comparison ----"),debug.log("segment",{A:e,B:t,C:a,D:i});var n={};if(e.x===a.x&&e.y===a.y||e.x===i.x&&e.y===i.y||t.x===a.x&&t.y===a.y||t.x===i.x&&t.y===i.y)return debug.log("segment","end point shared"),n.touch=!0,n.intersect=!1,debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n;var r=[e.x,t.x].sort((function(e,t){return e-t})),o=[a.x,i.x].sort((function(e,t){return e-t}));if(o[1]<r[0]||r[1]<o[0]||r[1]<o[0]||o[1]<r[0])return debug.log("segment","ranged out - x"),n.touch=!1,n.intersect=!1,debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n;var l=[e.y,t.y].sort((function(e,t){return e-t})),c=[a.y,i.y].sort((function(e,t){return e-t}));if(c[1]<l[0]||l[1]<c[0]||l[1]<c[0]||c[1]<l[0])return debug.log("segment","ranged out - y"),n.touch=!1,n.intersect=!1,debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n;var s=t.y-e.y,d=t.x-e.x,p=i.y-a.y,h=i.x-a.x;if(s*h==p*d)return debug.log("segment","parallel"),(e.y-a.y)*h==(e.x-a.x)*p?(debug.log("segment","collinear"),n.touch=!1,n.intersect=!0,debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n):(debug.log("segment","not collinear"),n.touch=!1,n.intersect=!1,debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n);debug.log("segment","not parallel");var v={};return 0===d?(debug.log("segment","AB is vertical"),v.x=e.x,v.y=p/h*(v.x-a.x)+a.y,n.intersect=l[0]<v.y&&v.y<l[1]&&o[0]<v.x&&v.x<o[1],n.touch=!n.intersect&&(v.y===e.y||v.y===t.y?o[0]<=v.x&&v.x<=o[1]:(v.x===a.x||v.x===i.x)&&(l[0]<=v.y&&v.y<=l[1])),debug.log("segment",{I:v}),debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n):0===h?(debug.log("segment","CD is vertical"),v.x=a.x,v.y=s/d*(v.x-e.x)+e.y,n.intersect=r[0]<v.x&&v.x<r[1]&&c[0]<v.y&&v.y<c[1],n.touch=!n.intersect&&(v.x===e.x||v.x===t.x?c[0]<=v.y&&v.y<=c[1]:(v.y===a.y||v.y===i.y)&&(r[0]<=v.x&&v.x<=r[1])),debug.log("segment",{I:v}),debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n):(debug.log("segment","neither is vertical"),v.x=(e.y-a.y+a.x*(p/h)-e.x*(s/d))/(p/h-s/d),v.y=p/h*(v.x-a.x)+a.y,n.intersect=r[0]<v.x&&v.x<r[1]&&o[0]<v.x&&v.x<o[1],n.touch=!n.intersect&&(v.x===e.x||v.x===t.x?o[0]<=v.x&&v.x<=o[1]:(v.x===a.x||v.x===i.x)&&(r[0]<=v.x&&v.x<=r[1])),debug.log("segment",{I:v}),debug.log("segment",n),debug.log("segment","---- end segment comparison ----"),n)}function init_cells(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"init_cells"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=e.mapid;check_required.call(this,{mapid:n});var r=get_navmap(n),o=r.arr,l=r.cells;try{for(var c=0;c<o.length;c++){var s,d,p,h=o[c],v=get_navtile(h),u=convert_i2xy(c,n),y=u.x,m=u.y;null!==(s=l[y])&&void 0!==s||(l[y]=[]),null!==(p=(d=l[y])[m])&&void 0!==p||(d[m]={}),l[y][m].tileid=h,l[y][m].hole=v.hole,l[y][m].entities={}}}catch(e){console.error("".concat(this.name,' - failed to calculate tiles -> cells for map "').concat(n,'" (init_cells)')),console.error(e)}try{for(var g in naventities){void 0!==naventities[g].points[n]&&update_cell_entity.call(this,{mapid:n,entityid:g,action:"write"})}}catch(e){console.error("".concat(this.name,' - failed to calculate entities -> cells for map "').concat(n,'" (init_cells)')),console.error(e)}}function update_cell_entity(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"update_cell_entity"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=e.mapid,r=e.entityid,o=e.action;if(check_required.call(this,{mapid:n}),check_required.call(this,{entityid:r}),"delete"!==o&&"write"!==o)return this.error("".concat(this.name,' - failed to update cells, invalid action request on map "').concat(n,'" for entity "').concat(r,'" (update_cell_entity)'));var l=get_navmap(n),c=get_naventity(r),s=l.rows,d=l.cols,p=l.cells,h=c.points[n],v=h.x,u=h.y,y=_objectSpread(_objectSpread({},dirs_0),dirs_8);for(var m in y){var g=y[m],f=v+g.delta.x,_=u+g.delta.y;if(f>=1&&f<=d&&_>=1&&_<=s)if("delete"===o)delete p[f][_].entities[r];else if("write"===o)if("C"===m)p[f][_].entities[r]={entityid:r,solid:c.solid,delta:g.delta,touches:!0};else{var b=check_collision.call(this,{mapid:n,entityid:r,delta:g.delta});p[f][_].entities[r]={entityid:r,solid:c.solid,delta:g.delta,touches:0===b.types.filter((function(e){return"wall"===e.type})).length}}}}function check_collision(e){var t,a,i,n,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"check_collision"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var o=_objectSpread({delta:{},ignore:{holes:!1,walls:!1,entities:!1}},e),l=o.mapid,c=o.entityid,s=o.delta,d=o.ignore;null!==(n=s.x)&&void 0!==n||(s.x=0),null!==(r=s.y)&&void 0!==r||(s.y=0),check_required.call(this,{mapid:l}),check_required.call(this,{entityid:c});var p=get_navmap(l),h=get_naventity(c);if(void 0!==h.points[l]){var v=p.cols,u=p.rows,y=p.cells,m=h.points[l],g=m.x,f=m.y,_=g+s.x,b=f+s.y,w={detected:!1,types:[]};try{(_<1||_>v||b<1||b>u)&&(w.detected=!0,w.types.push({type:"map",mapid:l}))}catch(e){console.error("".concat(this.name,' - failed to check collisions against map boundaries for entity "').concat(c,'" on map "').concat(l,'" (check_collision)')),console.error(e)}try{!d.holes&&y[_][b].hole&&(w.detected=!0,w.types.push({type:"hole",tileid:y[_][b].tileid}))}catch(e){console.error("".concat(this.name,' - failed to check collisions against tile holes for entity "').concat(c,'" on map "').concat(l,'" (check_collision)')),console.error(e)}try{if(!d.entities)for(var x in y[_][b].entities){var k=y[_][b].entities[x];k.solid&&0===k.delta.x&&0===k.delta.y&&(w.detected=!0,w.types.push({type:"entity",entityid:x}))}}catch(e){console.error("".concat(this.name,' - failed to check collisions against entities for entity "').concat(c,'" on map "').concat(l,'" (check_collision)')),console.error(e)}try{if(!d.walls){var S={x:g-.5,y:f-.5},j={x:_-.5,y:b-.5};for(var $ in navwalls){var O=navwalls[$];if(void 0!==O.points[l])for(var N=O.points[l],E=0;E<N.length-1;E++){var T=compare_segments(S,j,{x:N[E].x,y:N[E].y},{x:N[E+1].x,y:N[E+1].y});T.intersect&&(w.detected=!0,w.types.push({type:"wall",subtype:"intersect",wallid:$})),T.touch&&(w.detected=!0,w.types.push({type:"wall",subtype:"touch",wallid:$}))}}}}catch(e){console.error("".concat(this.name,' - failed to check collisions against walls for entity "').concat(c,'" on map "').concat(l,'" (check_collision)')),console.error(e)}return w}console.error("".concat(this.name,' - no entity "').concat(c,'" found on map "').concat(l,'"'))}function new_navmap(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_navmap"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=_objectSpread({diagonal:def.nav.diagonal},e),r=n.source,o=n.mapid,l=n.mapname,c=n.diagonal,s=n.inputtype,d=n.inputmap,p=n.maphtml;if(check_required.call(this,{mapid:o}),!d)return this.error("".concat(this.name,"macro"===r?" - missing required macro payload":' - missing required input "inputmap"'));var h=e.cols;if(!Number.isInteger(h)||h<1)return this.error("".concat(this.name," - # of columns must be an integer greater than zero"));try{new Navmap(o,l,s,d,h,c,p)}catch(e){console.error("".concat(this.name,' - failed to create Navmap object for map "').concat(o,'" (new_navmap)')),console.error(e)}}function new_navtile(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_navtile"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=e.tileid,r=e.tilename,o=e.tilehtml,l=e.hole;check_required.call(this,{tileid:n});try{var c=get_navtile(n);if(void 0!==c)for(var s in void 0!==l&&(c.hole=l),void 0!==r&&(c.tilename=r),o){var d,p;c.tilehtml[s]=o[s],null!==(p=(d=c.tilehtml).default)&&void 0!==p||(d.default=n)}else new Navtile(n,r,o,l)}catch(e){console.error("".concat(this.name,' - failed to create new tile definition for "').concat(n,'" (new_navtile)')),console.error(e)}}function new_navdisplay(e){var t,a,i,n;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_navdisplay"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var r=e.mapid,o=e.rows_view,l=e.cols_view,c=e.x0,s=e.y0,d=e.entityid_view,p=null!==(n=e.displayid)&&void 0!==n?n:r;if(check_required.call(this,{mapid:r}),!def.skipcheck.clobbering&&get_navdisplay(r,p)&&console.error("".concat(this.name,' - display with id "').concat(p,'" already exists for map "').concat(r,'"')),check_extant.call(this,{mapid:r}),void 0!==l&&(!Number.isInteger(l)||l<1))return this.error("".concat(this.name," - # of columns must be an integer greater than zero"));if(void 0!==o&&(!Number.isInteger(o)||o<1))return this.error("".concat(this.name," - # of rows must be an integer greater than zero"));void 0!==d&&(check_extant.call(this,{entityid:d},{label:"id of entity to track"}),void 0===get_naventity(d).points[r]&&console.error("".concat(this.name,' - no coordinates set for entity "').concat(d,'" on map "').concat(r,'"')),void 0===c&&void 0===s||console.error("".concat(this.name," - when both x0, y0, entityid_view are all provided, only x0 and y0 will be used")));var h=get_navmap(r),v=h.cols,u=h.rows;try{var y,m,g,f,_,b,w=Math.clamp(1,v,null!==(y=null!=l?l:o)&&void 0!==y?y:v),x=Math.clamp(1,u,null!==(m=null!=o?o:l)&&void 0!==m?m:u);if(void 0!==d){var k=get_naventity(d).points[r],S=k.x,j=k.y;void 0!==S&&(_=Math.clamp(1,v-l+1,S-Math.floor(l/2))),void 0!==j&&(b=Math.clamp(1,u-o+1,j-Math.floor(o/2)))}void 0!==c&&(_=Math.clamp(1,v-l+1,c)),void 0!==s&&(b=Math.clamp(1,u-o+1,s)),navdisplays[p]={displayid:p,mapid:r,entityid_view:d,cols_view:w,rows_view:x,x0:null!==(g=_)&&void 0!==g?g:1,y0:null!==(f=b)&&void 0!==f?f:1}}catch(e){console.error("".concat(this.name," - failed to initialize navdisplay with validated values (new_navdisplay)")),console.error(e)}}function print_navdisplay(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"print_navdisplay"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=_objectSpread({print_tiles:def.display.print_tiles},e),r=n.displayid,o=n.print_tiles;check_required.call(this,{displayid:r}),check_extant.call(this,{displayid:r});var l=get_navdisplay(r);0!==$('.Navdisplay[data-display="'.concat(r,'"]')).length&&console.error("".concat(this.name,' - display with id "').concat(r,'" already printed, printing the same display twice may lead to unexpected behavior'));var c=$(document.createElement("div"));try{var s=l.mapid,d=l.entityid_view;c.addClass("Navdisplay").attr("data-mapid",s).data("mapid",s).attr("data-displayid",r).data("displayid",r).attr("data-entityid_view",d).data("entityid_view",d)}catch(e){console.error("".concat(this.name," - failed to intialize $display jQuery object (print_navdisplay)")),console.error(e)}update_navdisplay.call(this,{$display:c,print_tiles:o});try{setTimeout((function(){c.on(":update_navdisplay",(function(e,t){$(this).children().remove(),update_navdisplay.call(this,{$display:c,print_tiles:o,delta:t})}))}),40)}catch(e){console.error("".concat(this.name," - failed to assign navdisplay listeners (print_navdisplay)")),console.error(e)}return c}function update_navdisplay(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"update_navdisplay"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=e.$display,r=e.print_tiles,o=e.delta;if(check_required.call(this,{$display:n},{label:"jQuery object holding display to update"}),def.skipcheck.common||0!==n.length){var l=n.data("displayid"),c=get_navdisplay(l),s=c.mapid,d=get_navmap(s),p=d.arr,h=d.rows,v=d.cols,u=d.maphtml;calculate_navdisplay.call(this,{displayid:l,delta:o});var y=c.x0,m=c.y0,g=c.cols_view,f=c.rows_view;n.css({"grid-template-columns":"repeat(".concat(g,", 1fr)"),"grid-template-rows":"repeat(".concat(f,", 1fr)")});var _=[];try{for(var b=convert_xy2i({x:y,y:m},s),w=1;w<=f;w++)for(var x=1;x<=g;x++){var k=b+(x-1)+v*(w-1),S=p[k];if(r){var j=print_navtile.call(this,{displayid:l,tile:get_navtile(S),col:x,row:w});j.appendTo(n);var O=convert_i2xy(k,s),N=O.x,E=O.y;j.attr("data-x",N).data("x",N).attr("data-y",E).data("y",E)}_.push(k)}}catch(e){console.error("".concat(this.name,' - failed to print tiles for map display "').concat(l,'" (refresh_navdisplay)')),console.error(e)}try{for(var T in naventities){var C=naventities[T];if(void 0!==C.points[s]){var M=C.points[s],P=M.x,q=M.y,I=convert_xy2i({x:P,y:q},s);if(_.includes(I))print_naventity.call(this,{displayid:l,entity:C,col:P-y+1,row:q-m+1}).appendTo(n)}}}catch(e){console.error("".concat(this.name,' - failed to print entities for map display "').concat(l,'" (refresh_navdisplay)')),console.error(e)}try{for(var A in navwalls){var D,W=navwalls[A],H=W.wallname;if(void 0!==W.points[s]){var z=null!==(D=W.wallhtml[l])&&void 0!==D?D:W.wallhtml.default;if(void 0!==z){var F=W.points[s],B=F.sort((function(e,t){return e.x-t.x}))[0].x,G=F.sort((function(e,t){return t.x-e.x}))[0].x,L=F.sort((function(e,t){return e.y-t.y}))[0].y,Q=F.sort((function(e,t){return t.y-e.y}))[0].y,K=$(document.createElement("div"));K.wiki(z).addClass("Navwall").attr("title",H).attr("data-wallid",A).data("wallid",A).css({width:"max(".concat((G-B)/g*100,"%, ").concat(100/g*.2,"%)"),height:"max(".concat((Q-L)/f*100,"%, ").concat(100/f*.2,"%)"),left:(B-(y-1))/g*100+"%",top:(L-(m-1))/f*100+"%"}),K.appendTo(n)}}}}catch(e){console.error("".concat(this.name,' - failed to print walls for map display "').concat(l,'"')),console.error(e)}try{var U,R=null!==(U=u[l])&&void 0!==U?U:u.default;if(void 0!==R){var V=$(document.createElement("div")).wiki(R);V.addClass("Navbg"),V.css({width:v/g*100+"%",height:h/f*100+"%",left:(1-y)/g*100+"%",top:(1-m)/f*100+"%"}),V.appendTo(n)}}catch(e){console.error("".concat(this.name,' - failed to attach background image for map display "').concat(l,'"')),console.error(e)}}else console.error("".concat(this.name," - empty jQuery object, no navdisplay supplied"))}function calculate_navdisplay(e){var t=e.displayid,a=e.delta,i=get_navdisplay(t),n=i.mapid,r=(i.entityid_view,get_navmap(n)),o=r.rows,l=r.cols,c=i.x0,s=i.y0,d=i.cols_view,p=i.rows_view;try{var h,v,u,y,m=Math.clamp(1,l,d+(null!==(h=null==a?void 0:a.cols)&&void 0!==h?h:0)),g=Math.clamp(1,o,p+(null!==(v=null==a?void 0:a.rows)&&void 0!==v?v:0)),f=Math.clamp(1,l-m+1,c+Math.floor((d-m)/2)+(null!==(u=null==a?void 0:a.x)&&void 0!==u?u:0)),_=Math.clamp(1,o-g+1,s+Math.floor((p-g)/2)+(null!==(y=null==a?void 0:a.y)&&void 0!==y?y:0));Object.assign(i,{x0:f,y0:_,cols_view:m,rows_view:g})}catch(e){console.error("".concat(this.name,' - failed to calculate new values for display "').concat(t,'" (calculate_navdisplay)')),console.error(e)}}function new_naventity(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_naventity"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=_objectSpread({solid:def.entity.solid},e),r=n.entityid,o=n.entityname,l=n.entityhtml,c=n.solid;check_required.call(this,{entityid:r}),check_required.call(this,{solid:c});try{var s=get_naventity(r);if(void 0!==s){if(s.solid=c,void 0!==o&&(s.entityname=o),void 0!==l)for(var d in l)s.entityhtml[d]=l[d]}else new Naventity(r,o,l,c)}catch(e){return console.error("".concat(this.name,' - failed to create new entity definition for "').concat(r,'" (new_naventity)')),this.error(e)}}function set_naventity(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"set_naventity"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=_objectSpread({point:{}},e),r=n.entityid,o=n.mapid,l=n.point,c=n.x,s=n.y;if(check_required.call(this,{entityid:r}),check_required.call(this,{mapid:o}),check_extant.call(this,{entityid:r}),check_extant.call(this,{mapid:o}),void 0!==c&&(l.x=c),void 0!==s&&(l.y=s),void 0===l.x||void 0===l.y)return this.error("".concat(this.name,' - cell input for entity "').concat(r,'" on map "').concat(o,'" required — use point input {x,y} or individual x & y number inputs'));var d=get_navmap(o),p=d.rows,h=d.cols;if(!Number.isInteger(l.x)||!Number.isInteger(l.y))return this.error("".concat(this.name,' - both x and y must be integers for entity "').concat(r,'" on map "').concat(o,'"'));def.skipcheck.common||((l.x<1||h<l.x)&&console.error("".concat(this.name,' - x input ("').concat(l.x,'") for entity "').concat(r,'" is outside horizontal map cell boundaries [1 to ').concat(h,'] inclusive, for map "').concat(o,'"')),(l.y<1||p<l.y)&&console.error("".concat(this.name,' - y input ("').concat(l.y,'") for entity "').concat(r,'" is outside vertical map cell boundaries [1 to ').concat(p,'] inclusive, for map "').concat(o,'"'))),get_naventity(r).points[o]=_objectSpread({},l),update_cell_entity.call(this,{mapid:o,entityid:r,action:"write"});try{$('.Navdisplay[data-mapid="'.concat(o,'"]')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(o,'"]')).trigger(":update_navrose")}catch(e){console.error("".concat(this.name,' - failed to update navdisplays while setting entity "').concat(r,'" on map "').concat(o,'" (set_naventity)')),console.error(e)}}function rem_naventity(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"rem_naventity"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=e.entityid,r=e.mapid;check_required.call(this,{entityid:n}),check_required.call(this,{mapid:r}),def.skipcheck.common||(check_extant.call(this,{entityid:n}),check_extant.call(this,{mapid:r})),void 0===entity.points[r]&&console.error("".concat(this.name,' - no entity "').concat(n,'" found on map "').concat(r,'"'));try{var o=get_naventity(n);update_cell_entity.call(this,{mapid:r,entityid:n,action:"delete"}),delete o.points[r]}catch(e){console.error("".concat(this.name,' - failed to remove naventity "').concat(n,'" from map "').concat(r,'" (rem_naventity)')),console.error(e)}try{$('.Navdisplay[data-mapid="'.concat(r,'"]')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(r,'"]')).trigger(":update_navrose")}catch(e){console.error("".concat(this.name,' - failed to update navdisplays while removing entity "').concat(n,'" on map "').concat(r,'" (rem_naventity)')),console.error(e)}}function mov_naventity(e){var t,a,i,n,r;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"mov_naventity"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var o=_objectSpread({trigger_update:!0,ignore:def.nav.ignore,delta:{}},e),l=o.entityid,c=o.mapid,s=o.delta,d=o.deltax,p=o.deltay,h=o.ignore,v=o.trigger_update;null!==(n=s.x)&&void 0!==n||(s.x=0),null!==(r=s.y)&&void 0!==r||(s.y=0),check_required.call(this,{entityid:l}),check_required.call(this,{mapid:c}),void 0!==d&&(s.x=d),void 0!==p&&(s.y=p),check_extant.call(this,{entityid:l}),check_extant.call(this,{mapid:c});get_navmap(c).cells;var u=get_naventity(l),y=u.points[c].x,m=u.points[c].y,g=u.points[c].x+s.x,f=u.points[c].y+s.y,_=check_collision.call(this,{mapid:c,entityid:l,delta:s,ignore:h});try{_.detected||(update_cell_entity.call(this,{mapid:c,entityid:l,action:"delete"}),u.points[c].x=g,u.points[c].y=f,update_cell_entity.call(this,{mapid:c,entityid:l,action:"write"}))}catch(e){console.error("".concat(this.name,' - failed to move entity "').concat(l,'" on map "').concat(c,'" (mov_naventity)')),console.error(e)}$('.Navrose[data-entityid="'.concat(l,'"]')).trigger(":entity_move",{mapid:c,entityid:l,collisions:_.detected?_.types:null,start:{x:y,y:m},stop:_.detected?{x:y,y:m}:{x:g,y:f},attempt:s,success:_.detected});try{v&&!_.detected&&($('.Navdisplay[data-mapid="'.concat(c,'"]')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(c,'"]')).trigger(":update_navrose"))}catch(e){console.error("".concat(this.name,' - failed to trigger updates while moving entity "').concat(l,'" on map "').concat(c,'" (mov_naventity)')),console.error(e)}}function new_navwall(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"new_navwall"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=e.wallid,r=e.wallname,o=e.wallhtml;check_required.call(this,{wallid:n});try{var l=get_navwall(n);if(void 0!==l){if(void 0!==r&&(l.wallname=r),void 0!==o)for(var c in o)l.wallhtml[c]=o[c]}else new Navwall(n,r,o)}catch(e){console.error("".concat(this.name,' - failed to create new navwall "').concat(n,'" (new_navwall)')),console.error(e)}}function set_navwall(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"set_navwall"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=_objectSpread({points:[]},e),r=n.wallid,o=n.mapid,l=n.points,c=n.x1,s=n.y1,d=n.x2,p=n.y2;check_required.call(this,{wallid:r}),check_required.call(this,{mapid:o}),check_extant.call(this,{mapid:o}),check_extant.call(this,{wallid:r});try{var h,v,u,y;if(void 0!==c)null!==(h=l[0])&&void 0!==h||(l[0]={}),l[0].x=c;if(void 0!==s)null!==(v=l[0])&&void 0!==v||(l[0]={}),l[0].y=s;if(void 0!==d)null!==(u=l[1])&&void 0!==u||(l[1]={}),l[1].x=d;if(void 0!==p)null!==(y=l[1])&&void 0!==y||(l[1]={}),l[1].y=p;if(l.length<2)return this.error("".concat(this.name," - at least two points are required to set a navwall"));var m=get_navwall(r),g=get_navmap(o),f=g.rows,_=g.cols;m.points[o]=[];var b,w=_createForOfIteratorHelper(l);try{for(w.s();!(b=w.n()).done;){var x=b.value,k=x.x,S=x.y;if(!Number.isInteger(k))return this.error("".concat(this.name,' - encountered non-integer x ("').concat(k,'") for point "{x: ').concat(k,", y: ").concat(S,'}" on wallid "').concat(r,'" for map "').concat(o,'"'));if(!Number.isInteger(S))return this.error("".concat(this.name,' - encountered non-integer y ("').concat(S,'") for point "{x: ').concat(k,", y: ").concat(S,'}" on wallid "').concat(r,'" for map "').concat(o,'"'));def.skipcheck.common||((k<0||_<k)&&console.error("".concat(this.name," - x for point {x:").concat(k,", y:").concat(S,'} on wallid "').concat(r,'" is outside horizontal map vertex boundaries [0 to ').concat(_,'] inclusive, for map "').concat(o,'"')),(S<0||f<S)&&console.error("".concat(this.name," - y for point {x:").concat(k,", y:").concat(S,'} on wallid "').concat(r,'" is outside vertical map vertex boundaries [0 to ').concat(f,'] inclusive, for map "').concat(o,'"'))),m.points[o].push(_objectSpread({},x))}}catch(e){w.e(e)}finally{w.f()}}catch(e){console.error("".concat(this.name,' - failed to add navwall "').concat(r,'" to map "').concat(o,'" (new_navwall)')),console.error(e)}}function print_navrose(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"print_navrose"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=_objectSpread({print_names:def.nav.print_names,codes:def.nav.codes},e),r=n.displayid,o=n.entityid,l=n.print_names,c=n.codes;check_required.call(this,{displayid:r}),check_required.call(this,{entityid:o}),check_extant.call(this,{entityid:o}),check_extant.call(this,{displayid:r});var s=get_navdisplay(r).mapid,d=get_navmap(s).diagonal;for(var p in dirs_8)void 0!==e["code_".concat(p)]&&(c[p]=e["code_".concat(p)]);var h=$(document.createElement("div")),v=crypto.randomUUID();try{h.addClass("Navrose").attr("data-mapid",s).data("mapid",s).attr("data-displayid",r).data("displayid",r).attr("data-print_names",l).data("print_names",l).attr("data-entityid",o).data("entityid",o).attr("data-navsn",v).data("navsn",v)}catch(e){console.error("".concat(this.name,' - failed to initialize nav rose for display "').concat(r,'" (print_navrose)')),console.error(e)}update_navrose.call(this,{$rose:h});try{setTimeout((function(){h.on(":update_navrose",(function(e){$(this).children().remove(),update_navrose.call(this,{$rose:h})})),h.on("click",(function(e){click_navrose.call(this,{displayid:r,mapid:s,entityid:o,ev:e})}))}),40)}catch(e){console.error("".concat(this.name,' - failed to assign navrose listeners for navrose with displayid "').concat(r,'" (print_navrose)')),console.error(e)}try{var u=d?dirs_8:dirs_4;setTimeout((function(){$(document).on("keydown.".concat(v),(function(e){if(0===$('[data-navsn="'.concat(v,'"]')).length)$(document).off("keydown.".concat(v));else for(var t in u)e.code===c[t]&&$('[data-navsn="'.concat(v,'"] .Navdir[data-dirid="').concat(t,'"]')).trigger("click")}))}),40)}catch(e){console.error("".concat(this.name,' - failed to create key press listeners for navrose with displayid "').concat(r,'"')),console.error(e)}return h}function update_navrose(e){var t,a,i;null!==(t=this.name)&&void 0!==t||(this.name=null!==(a=e.id)&&void 0!==a?a:"update_navrose"),null!==(i=this.error)&&void 0!==i||(this.error=function(e){throw new Error(e)});var n=e.$rose;if(check_required.call(this,{$rose:n},{label:"jQuery object holding navrose"}),def.skipcheck.common||0!==n.length){var r=n.data("mapid"),o=n.data("displayid"),l=n.data("entityid"),c=n.data("print_names"),s=get_navmap(r).diagonal,d=get_naventity(l);try{var p=_objectSpread(_objectSpread({},dirs_0),s?dirs_8:dirs_4);for(var h in p){print_navdir.call(this,{displayid:o,mapid:r,dir:p[h],entity:d,print_names:c}).appendTo(n)}}catch(e){console.error("".concat(this.name," - failed to update navrose (update_navrose)")),console.error(e)}}else console.error("".concat(this.name," - empty jQuery object, no navrose provided"))}function click_navrose(e){var t=e.displayid,a=e.mapid,i=e.entityid,n=e.ev,r=$(n.target);if(r.hasClass("Navdir")){var o=r.data("dirid"),l=_objectSpread(_objectSpread({},dirs_0),dirs_8)[o].delta;mov_naventity.call(this,{entityid:i,mapid:a,delta:l,trigger_update:!1});var c=get_navmap(a),s=get_navdisplay(t),d=get_naventity(i),p=c.cols,h=c.rows,v=s.cols_view,u=s.rows_view;try{var y=d.points[a],m=y.x,g=y.y,f=s.x0,_=s.y0,b=Math.clamp(1,p-v+1,m-Math.floor(v/2)),w=Math.clamp(1,h-u+1,g-Math.floor(u/2));$('.Navdisplay[data-displayid="'.concat(t,'"]')).trigger(":update_navdisplay",{x:b-f,y:w-_}),$('.Navdisplay[data-mapid="'.concat(a,'"]:not([data-displayid="').concat(t,'"])')).trigger(":update_navdisplay"),$('.Navrose[data-mapid="'.concat(a,'"]')).trigger(":update_navrose")}catch(e){console.error("".concat(this.name," - failed to update displays after navrose navigation (click_navrose)")),console.error(e)}}}Macro.add(["newnavmap","new_navmap"],{tags:["displayhtml"],handler:function(){debug.log("macro",'---- start "'.concat(this.name,'" handler ----'));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{mapid:{type:"string",alias:"map"},mapname:{type:"string",alias:"name"},cols:{type:"number",alias:"columns"},diagonal:{type:"boolean"}}});if(e.inputtype="array",e.inputmap=this.payload[0].contents.trim().split(/[\s\n]+/g),e.maphtml={},this.payload.length>1)for(var t=1;t<this.payload.length;t++){var a,i,n=_objectSpread({displayid:"default"},create_argObj.call(this,{id:this.name,args_in:this.payload[t].args,template:{displayid:{type:"string",alias:"display"}}})).displayid;def.skipcheck.clobbering||void 0===e.maphtml[n]||console.error("".concat(this.name,' - clobbering, child tag with displayid "').concat(n,'" already used in this macro call')),e.maphtml[n]=null===(a=this.payload[t])||void 0===a||null===(i=a.contents)||void 0===i?void 0:i.trim()}e.source="macro",debug.log("macro",e),debug.log("macro","---- end ".concat(this.name," handler ----")),new_navmap.call(this,e)}}),Macro.add(["newnavtile","new_navtile"],{tags:["displayhtml"],handler:function(){var e,t,a,i;debug.log("macro",'---- start "'.concat(this.name,'" handler ----'));var n=create_argObj.call(this,{id:this.name,args_in:this.args,template:{tileid:{type:"string",alias:"tile"},tilename:{type:"string",alias:"name"},hole:{type:"boolean"}}});if(n.tilehtml={},void 0!==(null===(e=this.payload[0])||void 0===e||null===(t=e.contents)||void 0===t?void 0:t.trim())&&""!==(null===(a=this.payload[0])||void 0===a||null===(i=a.contents)||void 0===i?void 0:i.trim())&&(n.tilehtml.default=this.payload[0].contents.trim()),this.payload.length>1)for(var r=1;r<this.payload.length;r++){var o,l,c=_objectSpread({displayid:"default"},create_argObj.call(this,{id:this.name,args_in:this.payload[r].args,template:{displayid:{type:"string",alias:"display"}}})).displayid;def.skipcheck.clobbering||void 0===n.tilehtml[c]||console.error("".concat(this.name,' - clobbering, child tag with displayid "').concat(c,'" already used in this macro call')),n.tilehtml[c]=null===(o=this.payload[r])||void 0===o||null===(l=o.contents)||void 0===l?void 0:l.trim()}n.source="macro",debug.log("macro",n),debug.log("macro","---- end ".concat(this.name," handler ----")),new_navtile.call(this,n)}}),Macro.add(["new_navdisplay","newnavdisplay"],{handler:function(){debug.log("macro",'---- start "'.concat(this.name,'" handler ----'));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{mapid:{type:"string",alias:"map"},displayid:{type:"string",alias:"display"},cols_view:{type:"number",alias:["viewcolumns","cols","columns"]},rows_view:{type:"number",alias:["viewrows","rows"]},x0:{type:"number"},y0:{type:"number"},entityid_view:{type:"string",alias:["viewentity","entityid"]}}});e.source="macro",debug.log("macro","---- end ".concat(this.name," handler ----")),debug.log("macro",e),new_navdisplay.call(this,e)}}),Macro.add(["print_navdisplay","printnavdisplay"],{handler:function(){debug.log("macro",'---- start "'.concat(this.name,'" handler ----'));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{displayid:{type:"string",alias:"display"},print_tiles:{type:"boolean"}}});e.source="macro",debug.log("macro","---- end ".concat(this.name," handler ----")),debug.log("macro",e),print_navdisplay.call(this,e).appendTo(this.output)}}),Macro.add(["newnaventity","new_naventity"],{tags:["displayhtml"],handler:function(){var e,t,a,i;debug.log("macro","---- start ".concat(this.name," handler ----"));var n=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},entityname:{type:"string",alias:"name"},solid:{type:"boolean"}}});if(n.entityhtml={},void 0!==(null===(e=this.payload[0])||void 0===e||null===(t=e.contents)||void 0===t?void 0:t.trim())&&""!==(null===(a=this.payload[0])||void 0===a||null===(i=a.contents)||void 0===i?void 0:i.trim())&&(n.entityhtml.default=this.payload[0].contents.trim()),this.payload.length>1)for(var r=1;r<this.payload.length;r++){var o,l,c=_objectSpread({displayid:"default"},create_argObj.call(this,{id:this.name,args_in:this.payload[r].args,template:{displayid:{type:"string",alias:"display"}}})).displayid;def.skipcheck.clobbering||void 0===n.entityhtml[c]||console.error("".concat(this.name,' - clobbering, child tag with displayid "').concat(c,'" already used in this macro call')),n.entityhtml[c]=null===(o=this.payload[r])||void 0===o||null===(l=o.contents)||void 0===l?void 0:l.trim()}n.source="macro",debug.log("macro",n),debug.log("macro","---- end ".concat(this.name," handler ----")),new_naventity.call(this,n)}}),Macro.add(["setnaventity","set_naventity"],{handler:function(){debug.log("macro","---- start ".concat(this.name," handler ----"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},mapid:{type:"string",alias:"map"},point:{type:"object",alias:"cell"},x:{type:"number"},y:{type:"number"}}});e.source="macro",debug.log("macro",e),debug.log("macro","---- end ".concat(this.name," handler ----")),set_naventity.call(this,e)}}),Macro.add(["remnaventity","rem_naventity"],{handler:function(){debug.log("macro","---- start ".concat(this.name," handler ----"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},mapid:{type:"string",alias:"map"}}});e.source="macro",debug.log("macro",e),debug.log("macro","---- end ".concat(this.name," handler ----")),rem_naventity.call(this,e)}}),Macro.add(["movnaventity","mov_naventity"],{handler:function(){debug.log("macro","---- start ".concat(this.name," handler ----"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{entityid:{type:"string",alias:"entity"},mapid:{type:"string",alias:"map"},delta:{type:"object"},deltax:{type:"number"},deltay:{type:"number"},ignore:{type:"object"},trigger_update:{type:"boolean"}}});e.source="macro",debug.log("macro",e),debug.log("macro","---- end ".concat(this.name," handler ----")),mov_naventity.call(this,e)}}),Macro.add(["new_navwall","newnavwall"],{tags:["displayhtml"],handler:function(){var e,t,a,i;debug.log("macro","---- start ".concat(this.name," handler ----"));var n=create_argObj.call(this,{id:this.name,args_in:this.args,template:{wallid:{type:"string",alias:"id"},wallname:{type:"string",alias:"name"}}});if(n.wallhtml={},void 0!==(null===(e=this.payload[0])||void 0===e||null===(t=e.contents)||void 0===t?void 0:t.trim())&&""!==(null===(a=this.payload[0])||void 0===a||null===(i=a.contents)||void 0===i?void 0:i.trim())&&(n.wallhtml.default=this.payload[0].contents.trim()),this.payload.length>1)for(var r=1;r<this.payload.length;r++){var o,l,c=_objectSpread({displayid:"default"},create_argObj.call(this,{id:this.name,args_in:this.payload[r].args,template:{displayid:{type:"string",alias:"display"}}})).displayid;def.skipcheck.clobbering||void 0===n.wallhtml[c]||console.error("".concat(this.name,' - clobbering, child tag with displayid "').concat(c,'" already used in this macro call')),n.wallhtml[c]=null===(o=this.payload[r])||void 0===o||null===(l=o.contents)||void 0===l?void 0:l.trim()}n.source="macro",debug.log("macro",n),debug.log("macro","---- end ".concat(this.name," handler ----")),new_navwall.call(this,n)}}),Macro.add(["set_navwall","setnavwall"],{handler:function(){debug.log("macro","---- start ".concat(this.name," handler ----"));var e=create_argObj.call(this,{id:this.name,args_in:this.args,template:{wallid:{type:"string",alias:"wall"},mapid:{type:"string",alias:"map"},points:{type:"array",alias:"vertices"},x1:{type:"number"},y1:{type:"number"},x2:{type:"number"},y2:{type:"number"}}});e.source="macro",debug.log("macro",e),debug.log("macro","---- end ".concat(this.name," handler ----")),set_navwall.call(this,e)}}),Macro.add(["print_navrose","printnavrose"],{handler:function(){var e;debug.log("macro","---- start ".concat(this.name," handler ----"));var t=create_argObj.call(this,{id:this.name,args_in:this.args,template:(e={displayid:{type:"string",alias:"display"},entityid:{type:"string",alias:"entity"},print_names:{type:"boolean",alias:"names"},codes:{type:"object"},code_N:{type:"string"},code_E:{type:"string"},code_S:{type:"string"},code_W:{type:"string"},code_NW:{type:"string"}},_defineProperty(e,"code_NW",{type:"string"}),_defineProperty(e,"code_SE",{type:"string"}),_defineProperty(e,"code_SW",{type:"string"}),e)});t.source="macro",debug.log("macro",t),debug.log("macro","---- end ".concat(this.name," handler ----")),print_navrose.call(this,t).appendTo(this.output)}});var songs={Oxide:{bpm:125,src:"./assets/Oxide.m4a",length:1e4,beats:[1e3,1e3,1e3,1e3,1e3,1e3,1e3,1e3,1e3,1e3]},DeepSeaBass:{src:"./assets/DeapSeaBass.mp3",bpm:125,interval:476,beats:[476]}},hearts={},howls={},meter_interval=476,heart=function(){function e(t,a){var i;_classCallCheck(this,e),hearts[t]=this,this.heartid=t,this.songid=a,this.running=!1,this.c_interval=30;var n=songs[this.songid];this.b_interval=null!==(i=n.interval)&&void 0!==i?i:6e4/n.bpm,$(".nav").css({"--animDur":this.b_interval+"ms"}),$(".meter").css({"--animDur":meter_interval+"ms"}),howls[t]=new Howl({src:[n.src],html5:!0,autoloop:!0})}return _createClass(e,[{key:"start",value:function(){this.running=!0,this.t_start=Date.now(),this.c=0,this.b=0,this.check();var e=howls[this.heartid];setTimeout((function(){e.play()}),300)}},{key:"stop",value:function(){this.running=!1,this.howl.stop()}},{key:"check",value:function(){if(this.running){Date.now()>this.t_start+this.b*this.b_interval&&(this.beat_meter(),this.beat_nav(),this.b++);var e=this.t_start+this.c*this.c_interval,t=Date.now()-e,a=this.check.bind(this);setTimeout((function(){a()}),Math.max(this.c_interval-t,0)),this.c++}}},{key:"beat_meter",value:function(){var e=this.b;$(document.createElement("div")).addClass("meterBar left").attr("data-beat",e).appendTo("#meter1"),$(document.createElement("div")).addClass("meterBar right").attr("data-beat",e).appendTo("#meter1"),setTimeout((function(){$(".meterBar[data-beat=".concat(e,"]")).remove()}),meter_interval)}},{key:"beat_nav",value:function(){$(".nav").removeClass("beat"),setTimeout((function(){$(".nav").addClass("beat")}),0)}}],[{key:"record",value:function(e,t,a){var i=[],n=[],r=[];$(document).on("keydown.heart",(function(o){o.code===t?($(document).off("keydown.heart"),console.log({time:i,special:r,beats:n})):o.code===e?0===n.length?(n.push(0),i.push(Date.now())):(n.push(Date.now()-i[i.length-1]),i.push(Date.now())):o.code===a&&r.push(n.length-1)}))}}]),e}();setup.Oxide=new heart("oxide","Oxide"),setup.DeepSeaBass=new heart("deapseabass","DeepSeaBass"),UIBar.destroy(),$(document).one(":passageend",(function(){setPageElement("display1","display1"),setPageElement("nav1","nav1"),setPageElement("display2","display2"),setPageElement("nav2","nav2")}));